<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시도당·당협위원회 구성 - 자유와혁신</title>
    
    <!-- SEO 메타 태그 -->
    <meta name="description" content="자유와혁신 서울특별시당 각 당협위원회별 카카오톡 팀채팅 안내. 행정동 기준으로 해당 지역구를 찾아 참여하세요.">
    <meta name="keywords" content="자유와혁신, 당협위원회, 서울시당, 카카오톡, 지역구, 황교안">
    <meta name="author" content="자유와혁신">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://forthefreedom.kr/local-chapters.html">
    
    <!-- 파비콘 설정 -->
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicon.png">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png">
    <link rel="icon" href="images/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'red-600': '#A50034',
                        'red-700': '#8B002C',
                        'red-800': '#700024',
                        'red-900': '#56001C',
                        'red-50': '#FDF2F4',
                        'red-100': '#FCE7EA',
                        'red-500': '#A50034',
                        'kakao': '#FEE500'
                    }
                }
            }
        }
    </script>
    <style>
        .text-red-600 { color: #A50034 !important; }
        .bg-red-600 { background-color: #A50034 !important; }
        .border-red-600 { border-color: #A50034 !important; }
        .hover\:bg-red-700:hover { background-color: #8B002C !important; }
        
        .chapter-card {
            transition: all 0.2s ease;
        }
        .chapter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .chapter-card.highlight {
            border-color: #A50034 !important;
            background-color: #FDF2F4 !important;
        }
        .kakao-btn {
            background-color: #FEE500;
            color: #000000;
            transition: all 0.2s ease;
        }
        .kakao-btn:hover {
            background-color: #E6CF00;
        }
        .dong-tag {
            display: inline-block;
            background-color: #f3f4f6;
            color: #4b5563;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }
        .dong-tag.matched {
            background-color: #A50034;
            color: white;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div id="navigation-container"></div>
    
    <!-- 브레드크럼 -->
    <section class="bg-gray-50 py-8 mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="text-sm">
                <ol class="list-none p-0 inline-flex space-x-2">
                    <li class="flex items-center">
                        <a href="index.html" class="text-gray-500 hover:text-red-600">홈</a>
                        <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    </li>
                    <li class="text-gray-900">시도당·당협위원회 구성</li>
                </ol>
            </nav>
        </div>
    </section>

    <main class="bg-white">
        <section class="py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- 페이지 헤더 -->
                <div class="text-center mb-12">
                    <h1 class="text-4xl font-bold text-gray-900 mb-6">시도당·당협위원회</h1>
                </div>

                <!-- 시도당 탭 -->
                <div class="mb-8">
                    <div class="flex flex-wrap justify-center gap-2 border-b border-gray-200 pb-4" id="tabContainer">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>

                <!-- 공식 채널 섹션 -->
                <div id="officialChannelSection" class="mb-16">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-l-4 border-red-600 pl-4">서울특별시당 공식 채널</h2>
                    
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4" id="officialChannelGrid">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>

                <!-- 당협위원회별 채팅방 섹션 -->
                <div id="chatRoomSection">
                    <!-- 분과위원회 섹션 -->
                    <div id="committeeSection" class="mb-16">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2 border-l-4 border-red-600 pl-4" id="committeeTitle">서울특별시당 분과위원회 채팅방</h2>
                        <p class="text-gray-600 mb-6 pl-5">당원 여러분의 적극적인 참여 부탁드립니다.</p>
                        
                        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4" id="committeeGrid">
                            <!-- 동적으로 생성됨 -->
                        </div>
                    </div>

                    <!-- 당협위원회별 채팅방 -->
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-l-4 border-red-600 pl-4" id="chatRoomTitle">서울특별시당 당협위원회별 채팅방</h2>
                    
                    <p class="text-base text-red-600 font-medium mb-6">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        자신의 도로명 주소가 아닌, <strong>행정동 단위</strong>로 구분하여 지역구를 선택하셔야 합니다.
                    </p>

                    <!-- 검색 영역 -->
                    <div class="mb-10 max-w-2xl mx-auto" id="searchArea">
                        <div class="relative">
                            <input type="text" id="searchInput" 
                                   placeholder="행정동 또는 구 이름을 입력하세요 (예: 역삼1동, 강남구, 송파)" 
                                   class="w-full px-5 py-4 pr-12 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 text-lg">
                            <button onclick="searchDong()" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <p id="searchResult" class="mt-3 text-center text-gray-600 hidden"></p>
                    </div>

                    <!-- 지역구 카드 목록 -->
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="chaptersContainer">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>
                
                <!-- 준비중 메시지 -->
                <div id="preparingMessage" class="hidden text-center py-20">
                    <div class="max-w-md mx-auto">
                        <i class="fas fa-hard-hat text-gray-400 text-6xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-gray-700 mb-4" id="preparingTitle">경기 시도당</h3>
                        <p class="text-gray-500 text-lg">당협위원회 구성 준비 중입니다.</p>
                        <p class="text-gray-400 mt-2">빠른 시일 내에 안내드리겠습니다.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="config.js"></script>
    <script src="nav.js"></script>
    <script>
        // 시도당 목록
        const provinces = [
            { id: 'seoul', name: '서울', hasData: true },
            { id: 'gyeonggi', name: '경기', hasData: false },
            { id: 'incheon', name: '인천', hasData: false },
            { id: 'busan', name: '부산', hasData: false },
            { id: 'daegu', name: '대구', hasData: false },
            { id: 'daejeon', name: '대전', hasData: false },
            { id: 'gwangju', name: '광주', hasData: false },
            { id: 'sejong', name: '세종', hasData: false },
            { id: 'gangwon', name: '강원', hasData: false },
            { id: 'chungbuk', name: '충북', hasData: false },
            { id: 'chungnam', name: '충남', hasData: false },
            { id: 'gyeongbuk', name: '경북', hasData: false },
            { id: 'gyeongnam', name: '경남', hasData: false },
            { id: 'jeonbuk', name: '전북', hasData: false },
            { id: 'jeonnam', name: '전남', hasData: false },
            { id: 'jeju', name: '제주', hasData: false }
        ];

        let currentProvince = 'seoul';

        // 공식 채널 데이터
        const officialChannels = {
            seoul: {
                title: '자유와혁신 서울특별시당 공식채널',
                committeeTitle: '서울특별시당 분과위원회 채팅방',
                chatTitle: '서울특별시당 당협위원회별 채팅방',
                channels: [
                    { name: '공식 문의 e-mail', value: 'seoul@freeinno.kr', type: 'email', icon: 'fas fa-envelope' },
                    { name: '네이버 블로그', value: '확보 예정', type: 'text', icon: 'fas fa-blog' },
                    { name: '인스타그램', value: 'https://www.instagram.com/freeinno_seoul', type: 'link', icon: 'fab fa-instagram' },
                    { name: '스레드', value: 'https://www.threads.com/@freeinno_seoul', type: 'link', icon: 'fas fa-at' },
                    { name: '엑스(구 트위터)', value: 'https://x.com/freeinno_seoul', type: 'link', icon: 'fab fa-x-twitter' },
                    { name: '페이스북', value: 'https://www.facebook.com/profile.php?id=61584750230843', type: 'link', icon: 'fab fa-facebook' },
                    { name: '유튜브 채널', value: 'https://www.youtube.com/@freeinno_seoul', type: 'link', icon: 'fab fa-youtube' },
                    { name: '디스코드(온라인 당사)', value: '필요시마다 링크 공유', type: 'text', icon: 'fab fa-discord' }
                ],
                committees: [
                    { name: '홍보분과', kakaoLink: 'https://invite.kakao.com/tc/otfoxuy2HS' },
                    { name: '조직강화분과', kakaoLink: 'https://invite.kakao.com/tc/3mS6hHHXby' },
                    { name: '정책분과', kakaoLink: 'https://invite.kakao.com/tc/V5Sw3TgOcl' },
                    { name: '투쟁분과', kakaoLink: 'https://invite.kakao.com/tc/HhMLfyDGMb' },
                    { name: '자원봉사단', kakaoLink: 'https://invite.kakao.com/tc/zeFFJuImTP' }
                ]
            }
        };

        // API에서 가져온 데이터
        let chaptersData = [];

        // 현재 활성화된 당협 데이터 가져오기
        function getChapters() {
            if (currentProvince === 'seoul') {
                return chaptersData;
            }
            return [];
        }

        // API에서 지역구 데이터 로드
        async function loadChaptersFromAPI() {
            try {
                const apiBase = (typeof window.API_BASE !== 'undefined' ? window.API_BASE : 'https://forthefreedom-kr-production.up.railway.app/api');
                const response = await fetch(`${apiBase}/chapters?province=seoul`);
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    // API 데이터를 프론트엔드 형식으로 변환
                    chaptersData = result.data.map(chapter => ({
                        name: chapter.name,
                        dongs: chapter.dongs || [],
                        kakaoLink: chapter.kakaoLink,
                        note: chapter.note || null,
                        chairman: chapter.chairmanName ? {
                            name: chapter.chairmanName,
                            website: chapter.chairmanWebsite,
                            instagram: chapter.chairmanInstagram,
                            facebook: chapter.chairmanFacebook,
                            threads: chapter.chairmanThreads,
                            x: chapter.chairmanX,
                            naverBlog: chapter.chairmanNaverBlog,
                            youtube: chapter.chairmanYoutube,
                            memberId: chapter.chairmanMemberId
                        } : null
                    }));
                    console.log('✅ API에서 지역구 데이터 로드:', chaptersData.length, '개');
                } else {
                    console.log('⚠️ 지역구 데이터 없음 - 관리자 페이지에서 시드 데이터를 생성하세요');
                }
            } catch (error) {
                console.error('❌ API 로드 실패:', error.message);
            }
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', async () => {
            loadNavigation();
            renderTabs();
            
            // API에서 먼저 데이터 로드 시도 (완료 후 렌더링)
            await loadChaptersFromAPI();
            
            // API 로드 후 렌더링
            switchProvince('seoul');
            
            // 엔터키 검색
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchDong();
            });
        });

        // 탭 렌더링
        function renderTabs() {
            const container = document.getElementById('tabContainer');
            container.innerHTML = provinces.map(province => `
                <button onclick="switchProvince('${province.id}')" 
                        id="tab-${province.id}"
                        class="tab-btn px-4 py-2 rounded-lg text-sm font-medium transition-all
                               ${province.id === currentProvince 
                                   ? 'bg-red-600 text-white' 
                                   : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}
                               ${!province.hasData ? 'opacity-70' : ''}">
                    ${province.name}
                    ${!province.hasData ? '<span class="text-xs ml-1">(준비중)</span>' : ''}
                </button>
            `).join('');
        }

        // 시도당 전환
        function switchProvince(provinceId) {
            currentProvince = provinceId;
            const province = provinces.find(p => p.id === provinceId);
            
            // 탭 스타일 업데이트
            provinces.forEach(p => {
                const tabEl = document.getElementById(`tab-${p.id}`);
                if (p.id === provinceId) {
                    tabEl.classList.remove('bg-gray-100', 'text-gray-600', 'hover:bg-gray-200');
                    tabEl.classList.add('bg-red-600', 'text-white');
                } else {
                    tabEl.classList.remove('bg-red-600', 'text-white');
                    tabEl.classList.add('bg-gray-100', 'text-gray-600', 'hover:bg-gray-200');
                }
            });
            
            // 검색 초기화
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResult').classList.add('hidden');
            
            if (province.hasData) {
                // 데이터가 있는 시도당
                document.getElementById('officialChannelSection').classList.remove('hidden');
                document.getElementById('chatRoomSection').classList.remove('hidden');
                document.getElementById('preparingMessage').classList.add('hidden');
                
                // 공식 채널 렌더링
                renderOfficialChannels(provinceId);
                renderCommittees(provinceId);
                renderChapters();
            } else {
                // 준비 중인 시도당
                document.getElementById('officialChannelSection').classList.add('hidden');
                document.getElementById('chatRoomSection').classList.add('hidden');
                document.getElementById('preparingMessage').classList.remove('hidden');
                document.getElementById('preparingTitle').textContent = province.name + ' 시도당';
            }
        }

        // 공식 채널 렌더링
        function renderOfficialChannels(provinceId) {
            const channelData = officialChannels[provinceId];
            if (!channelData) return;
            
            document.getElementById('chatRoomTitle').textContent = channelData.chatTitle;
            
            const grid = document.getElementById('officialChannelGrid');
            grid.innerHTML = channelData.channels.map(channel => {
                let cardContent = '';
                let cardClass = 'bg-white rounded-xl p-4 border border-gray-200 transition-all h-20 flex flex-col justify-center';
                let cardWrapper = '';
                
                // X 로고는 SVG로 처리
                let iconHtml = '';
                if (channel.icon === 'fab fa-x-twitter') {
                    iconHtml = `<svg class="w-5 h-5 text-red-600 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>`;
                } else {
                    iconHtml = `<i class="${channel.icon} text-red-600 text-xl flex-shrink-0"></i>`;
                }
                
                // 회색 아이콘 버전
                let grayIconHtml = '';
                if (channel.icon === 'fab fa-x-twitter') {
                    grayIconHtml = `<svg class="w-5 h-5 text-gray-400 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>`;
                } else {
                    grayIconHtml = `<i class="${channel.icon} text-gray-400 text-xl flex-shrink-0"></i>`;
                }
                
                if (channel.type === 'email') {
                    // 이메일은 값 표시 + 클릭 시 mailto
                    cardWrapper = `<a href="mailto:${channel.value}" class="block">`;
                    cardContent = `
                        <div class="flex items-center gap-3">
                            ${iconHtml}
                            <div class="min-w-0">
                                <div class="font-medium text-gray-800">${channel.name}</div>
                                <div class="text-sm text-red-600 font-medium truncate">${channel.value}</div>
                            </div>
                        </div>
                    `;
                    cardClass += ' hover:shadow-md hover:border-red-300 cursor-pointer';
                } else if (channel.type === 'link') {
                    // 링크는 카드 클릭으로 이동
                    cardWrapper = `<a href="${channel.value}" target="_blank" rel="noopener noreferrer" class="block">`;
                    cardContent = `
                        <div class="flex items-center gap-3">
                            ${iconHtml}
                            <span class="font-medium text-gray-800">${channel.name}</span>
                            <i class="fas fa-external-link-alt text-gray-400 text-xs ml-auto flex-shrink-0"></i>
                        </div>
                    `;
                    cardClass += ' hover:shadow-md hover:border-red-300 cursor-pointer';
                } else {
                    // 텍스트(준비중 등)는 클릭 불가
                    cardWrapper = '<div class="block">';
                    cardContent = `
                        <div class="flex items-center gap-3">
                            ${grayIconHtml}
                            <div class="min-w-0">
                                <div class="font-medium text-gray-500">${channel.name}</div>
                                <div class="text-sm text-gray-400">${channel.value}</div>
                            </div>
                        </div>
                    `;
                    cardClass += ' opacity-60';
                }
                
                const closeWrapper = channel.type === 'text' ? '</div>' : '</a>';
                
                return `
                ${cardWrapper}
                    <div class="${cardClass}">
                        ${cardContent}
                    </div>
                ${closeWrapper}
                `;
            }).join('');
        }

        // 분과위원회 렌더링
        function renderCommittees(provinceId) {
            const channelData = officialChannels[provinceId];
            if (!channelData || !channelData.committees) {
                document.getElementById('committeeSection').classList.add('hidden');
                return;
            }
            
            document.getElementById('committeeSection').classList.remove('hidden');
            document.getElementById('committeeTitle').textContent = channelData.committeeTitle;
            
            const grid = document.getElementById('committeeGrid');
            grid.innerHTML = channelData.committees.map(committee => `
                <a href="${committee.kakaoLink}" target="_blank" rel="noopener noreferrer" class="block">
                    <div class="bg-white rounded-xl p-4 border border-gray-200 transition-all h-20 flex items-center hover:shadow-md hover:border-yellow-400 cursor-pointer">
                        <div class="flex items-center gap-3 w-full">
                            <svg class="w-6 h-6 flex-shrink-0" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
                                <path d="M128 36C70.562 36 24 72.713 24 118c0 29.279 19.466 54.97 48.748 69.477-1.593 5.494-10.237 35.344-10.581 37.689 0 0-.207 1.762.934 2.434s2.483.15 2.483.15c3.272-.457 37.943-24.811 43.944-29.03 5.995.849 12.168 1.28 18.472 1.28 57.438 0 104-36.712 104-82 0-45.287-46.562-82-104-82z" fill="#3C1E1E"/>
                            </svg>
                            <span class="font-medium text-gray-800">${committee.name}</span>
                            <i class="fas fa-external-link-alt text-gray-400 text-xs ml-auto flex-shrink-0"></i>
                        </div>
                    </div>
                </a>
            `).join('');
        }

        // 카드 렌더링
        function renderChapters(highlightTerm = null) {
            const container = document.getElementById('chaptersContainer');
            const chapters = getChapters();
            
            container.innerHTML = chapters.map((chapter, index) => {
                // 하이라이트 여부 체크 (동 + 구 모두)
                const isHighlighted = highlightTerm && isChapterMatch(chapter, highlightTerm);
                
                const dongsHtml = chapter.dongs.map(dong => {
                    const isMatched = highlightTerm && (dong.includes(highlightTerm) || highlightTerm.includes(dong.replace(/[0-9·]/g, '')));
                    return `<span class="dong-tag ${isMatched ? 'matched' : ''}">${dong}</span>`;
                }).join('');
                
                // 당협위원장 섹션
                let chairmanHtml = '';
                if (chapter.chairman) {
                    // URL에 프로토콜이 없으면 https:// 추가
                    const normalizeUrl = (url) => {
                        if (!url) return url;
                        if (url.startsWith('http://') || url.startsWith('https://')) return url;
                        return 'https://' + url;
                    };
                    
                    // SNS 아이콘 생성 (7개: 웹사이트, 인스타, 페북, 스레드, 엑스, 블로그, 유튜브)
                    let snsIcons = '';
                    if (chapter.chairman.website) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.website)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-blue-500 transition-colors" title="웹사이트">
                                       <i class="fas fa-globe"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.instagram) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.instagram)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-pink-500 transition-colors" title="인스타그램">
                                       <i class="fab fa-instagram"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.facebook) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.facebook)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-blue-600 transition-colors" title="페이스북">
                                       <i class="fab fa-facebook"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.threads) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.threads)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-gray-800 transition-colors" title="스레드">
                                       <i class="fas fa-at"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.x) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.x)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-gray-800 transition-colors" title="X(트위터)">
                                       <svg class="w-4 h-4 inline" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                     </a>`;
                    }
                    if (chapter.chairman.naverBlog) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.naverBlog)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-green-500 transition-colors" title="네이버 블로그">
                                       <i class="fas fa-blog"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.youtube) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.youtube)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-red-600 transition-colors" title="유튜브">
                                       <i class="fab fa-youtube"></i>
                                     </a>`;
                    }
                    
                    // 위원장 있음 - 나중에 회원 프로필 링크 연결 예정
                    chairmanHtml = `
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="text-xs text-gray-500 mb-1">당협위원장</div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-user-tie text-red-600"></i>
                                <span class="font-medium text-gray-800">${chapter.chairman.name}</span>
                                ${snsIcons ? `<div class="flex items-center gap-2 ml-2">${snsIcons}</div>` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    // 공석 - 지원 이메일 연결
                    const emailSubject = encodeURIComponent(`당협위원장 지원 (${chapter.name})`);
                    const emailBody = encodeURIComponent(`성명:\n연락처:\n지원동기:\n`);
                    chairmanHtml = `
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="text-xs text-gray-500 mb-1">당협위원장</div>
                            <a href="mailto:seoul@freeinno.kr?subject=${emailSubject}&body=${emailBody}" 
                               class="flex items-center gap-2 text-red-600 hover:text-red-700 transition-colors">
                                <i class="fas fa-paper-plane"></i>
                                <span class="font-medium">지원하기 →</span>
                            </a>
                            <div class="text-xs text-gray-400 mt-1">(공석 - 역량있는 분들의 많은 지원 바랍니다!)</div>
                        </div>
                    `;
                }
                
                return `
                <div class="chapter-card bg-white border-2 ${isHighlighted ? 'border-red-600 bg-red-50' : 'border-gray-200'} rounded-xl p-6" 
                     data-index="${index}" id="chapter-${index}">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-900">${chapter.name}</h3>
                        ${chapter.note ? `<span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">${chapter.note}</span>` : ''}
                    </div>
                    <div class="mb-4 flex flex-wrap gap-1">
                        ${dongsHtml}
                    </div>
                    <a href="${chapter.kakaoLink}" target="_blank" rel="noopener noreferrer"
                       class="kakao-btn w-full flex items-center justify-center gap-2 py-3 rounded-lg font-bold">
                        <svg width="20" height="20" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
                            <path d="M128 36C70.562 36 24 72.713 24 118c0 29.279 19.466 54.97 48.748 69.477-1.593 5.494-10.237 35.344-10.581 37.689 0 0-.207 1.762.934 2.434s2.483.15 2.483.15c3.272-.457 37.943-24.811 43.944-29.03 5.995.849 12.168 1.28 18.472 1.28 57.438 0 104-36.712 104-82 0-45.287-46.562-82-104-82z" fill="#000000"/>
                        </svg>
                        카카오톡 팀채팅 참여
                    </a>
                    ${chairmanHtml}
                </div>
                `;
            }).join('');
        }

        // 검색 매칭 함수 (동 + 구 이름 모두 검색)
        function isChapterMatch(chapter, searchTerm) {
            // 구 이름으로 검색 (예: "강남", "강남구", "송파" 등)
            const normalizedSearch = searchTerm.replace(/구$/, ''); // "강남구" -> "강남"
            const chapterGu = chapter.name.split(' ')[0]; // "강남 갑" -> "강남"
            
            if (chapterGu.includes(normalizedSearch) || normalizedSearch.includes(chapterGu)) {
                return true;
            }
            
            // 동 이름으로 검색
            return chapter.dongs.some(dong => 
                dong.includes(searchTerm) || searchTerm.includes(dong.replace(/[0-9·]/g, ''))
            );
        }

        // 검색 함수
        function searchDong() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const resultEl = document.getElementById('searchResult');
            const chapters = getChapters();
            
            if (!searchTerm) {
                resultEl.classList.add('hidden');
                renderChapters();
                return;
            }
            
            // 검색어로 해당 지역구 찾기 (동 + 구 모두)
            const matchedChapters = chapters.filter(chapter => isChapterMatch(chapter, searchTerm));
            
            if (matchedChapters.length > 0) {
                resultEl.innerHTML = `<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i>"${searchTerm}" → <strong>${matchedChapters.map(c => c.name).join(', ')}</strong> 지역구입니다.</span>`;
                resultEl.classList.remove('hidden');
                
                // 카드 하이라이트 및 스크롤
                renderChapters(searchTerm);
                
                // 첫 번째 매칭 카드로 스크롤
                const firstMatchIndex = chapters.findIndex(chapter => isChapterMatch(chapter, searchTerm));
                if (firstMatchIndex >= 0) {
                    setTimeout(() => {
                        document.getElementById(`chapter-${firstMatchIndex}`).scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }, 100);
                }
            } else {
                resultEl.innerHTML = `<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i>"${searchTerm}"에 해당하는 지역구를 찾을 수 없습니다. 행정동 또는 구 이름을 입력해주세요.</span>`;
                resultEl.classList.remove('hidden');
                renderChapters();
            }
        }
    </script>
</body>
</html>
