<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ììœ ì™€í˜ì‹  - ë°°ë„ˆ ê´€ë¦¬</title>
    
    <!-- íŒŒë¹„ì½˜ ì„¤ì • -->
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    
    <!-- API ì„¤ì • ë¡œë“œ -->
    <script src="/config.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#A50034',
                        'primary-dark': '#8B002C',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="../style.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .header h1 {
            font-size: 1.3rem;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            font-size: 1.2rem;
            color: #333;
        }

        .card-body {
            padding: 1.5rem;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd6;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        /* ë°°ë„ˆ ëª©ë¡ */
        .banner-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .banner-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .banner-item.inactive {
            opacity: 0.5;
        }

        .banner-order {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .banner-order button {
            background: #e9ecef;
            border: none;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .banner-order button:hover {
            background: #dee2e6;
        }

        .banner-thumbnail {
            width: 200px;
            height: 86px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .banner-info {
            flex: 1;
        }

        .banner-info h3 {
            font-size: 1rem;
            margin-bottom: 0.25rem;
            color: #333;
        }

        .banner-info p {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .banner-info small {
            color: #999;
            font-size: 0.8rem;
        }

        .banner-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* ì´ë¯¸ì§€ ì—…ë¡œë“œ */
        .image-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .image-upload.has-image {
            padding: 1rem;
        }

        .image-upload img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
        }

        .image-upload input {
            display: none;
        }

        .image-upload p {
            color: #666;
            margin-top: 0.5rem;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.2rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #28a745;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 1rem;
        }

        /* ì•Œë¦¼ */
        .alert {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .btn-remove-image {
            padding: 0.4rem 0.75rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            flex: 1;
        }

        .btn-remove-image:hover {
            background: #c82333;
        }

        .image-upload {
            min-height: 120px;
        }

        .image-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            align-items: center;
        }

        .image-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.75rem;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            flex: 1;
            justify-content: center;
        }

        .image-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #28a745;
        }

        .image-toggle .toggle-text {
            color: #333;
        }

        .image-toggle input[type="checkbox"]:not(:checked) + .toggle-text {
            color: #999;
            text-decoration: line-through;
        }
    </style>
</head>
<body>
    <div id="admin-nav-container"></div>
    <script src="admin-nav.js"></script>
    <script>loadAdminNav('banners');</script>

    <div class="container" style="padding-top: 6rem;">
        <div id="alertContainer"></div>

        <div class="card">
            <div class="card-header">
                <h2>ë°°ë„ˆ ëª©ë¡</h2>
                <button class="btn btn-success" onclick="openCreateModal()">
                    <i class="fas fa-plus"></i> ìƒˆ ë°°ë„ˆ ì¶”ê°€
                </button>
            </div>
            <div class="card-body">
                <div id="bannerList" class="banner-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>âš™ï¸ í‘œì‹œ ì„¤ì •</h2>
            </div>
            <div class="card-body">
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.5rem 0;">
                    <div>
                        <strong>ëœë¤ ìˆœì„œë¡œ í‘œì‹œ</strong>
                        <p style="color: #666; font-size: 0.85rem; margin-top: 0.25rem;">í™œì„±í™”í•˜ë©´ ë°°ë„ˆê°€ ëœë¤ ìˆœì„œë¡œ í‘œì‹œë©ë‹ˆë‹¤</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="randomOrderToggle" onchange="updateSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>ğŸ“Œ ì‚¬ìš© ì•ˆë‚´</h2>
            </div>
            <div class="card-body">
                <ul style="color: #666; line-height: 1.8;">
                    <li><strong>ê¶Œì¥ ì´ë¯¸ì§€ í¬ê¸°:</strong> 1380 x 591 í”½ì…€ (21:9 ë¹„ìœ¨)</li>
                    <li><strong>ì§€ì› í˜•ì‹:</strong> JPG, PNG, WebP</li>
                    <li><strong>ìˆœì„œ:</strong> ìœ„/ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìˆœì„œ ë³€ê²½ ê°€ëŠ¥</li>
                    <li><strong>í™œì„±í™”:</strong> í† ê¸€ ìŠ¤ìœ„ì¹˜ë¡œ í‘œì‹œ/ìˆ¨ê¹€ ì„¤ì •</li>
                    <li>ì œëª©ê³¼ ë¶€ì œëª©ì€ ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤ (ë¹„ì›Œë‘ë©´ ì´ë¯¸ì§€ë§Œ í‘œì‹œ)</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ë°°ë„ˆ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="bannerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ìƒˆ ë°°ë„ˆ ì¶”ê°€</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bannerForm">
                    <input type="hidden" id="bannerId">
                    
                    <div class="form-row" style="gap: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label>ğŸ–¥ï¸ PCìš© ì´ë¯¸ì§€</label>
                            <div class="image-upload" id="imageUpload" onclick="document.getElementById('imageInput').click()">
                                <i class="fas fa-desktop" style="font-size: 1.5rem; color: #667eea;"></i>
                                <p style="font-size: 0.9rem;">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                                <p style="font-size: 0.75rem; color: #999;">ê¶Œì¥: 1380 x 591px (21:9)</p>
                                <input type="file" id="imageInput" accept="image/*" onchange="previewImage(this, 'pc')">
                            </div>
                            <div class="image-controls">
                                <button type="button" id="removeImageBtn" class="btn-remove-image" onclick="removeImage('pc')" style="display: none;">
                                    <i class="fas fa-trash"></i> ì‚­ì œ
                                </button>
                                <label class="image-toggle" id="imageActiveToggle" style="display: none;">
                                    <input type="checkbox" id="imageActiveCheckbox" checked>
                                    <span class="toggle-text">PC í‘œì‹œ</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>ğŸ“± ëª¨ë°”ì¼ìš© ì´ë¯¸ì§€</label>
                            <div class="image-upload" id="mobileImageUpload" onclick="document.getElementById('mobileImageInput').click()">
                                <i class="fas fa-mobile-alt" style="font-size: 1.5rem; color: #28a745;"></i>
                                <p style="font-size: 0.9rem;">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                                <p style="font-size: 0.75rem; color: #999;">ê¶Œì¥: 800 x 1000px (4:5)</p>
                                <input type="file" id="mobileImageInput" accept="image/*" onchange="previewImage(this, 'mobile')">
                            </div>
                            <div class="image-controls">
                                <button type="button" id="removeMobileImageBtn" class="btn-remove-image" onclick="removeImage('mobile')" style="display: none;">
                                    <i class="fas fa-trash"></i> ì‚­ì œ
                                </button>
                                <label class="image-toggle" id="mobileImageActiveToggle" style="display: none;">
                                    <input type="checkbox" id="mobileImageActiveCheckbox" checked>
                                    <span class="toggle-text">ëª¨ë°”ì¼ í‘œì‹œ</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <p style="font-size: 0.8rem; color: #666; margin-bottom: 1rem; background: #f8f9fa; padding: 0.75rem; border-radius: 6px;">
                        ğŸ’¡ <strong>PCë§Œ ì—…ë¡œë“œ</strong>: PCì—ì„œë§Œ í‘œì‹œ | <strong>ëª¨ë°”ì¼ë§Œ ì—…ë¡œë“œ</strong>: ëª¨ë°”ì¼ì—ì„œë§Œ í‘œì‹œ | <strong>ë‘˜ ë‹¤ ì—…ë¡œë“œ</strong>: ê° ê¸°ê¸°ì—ì„œ í•´ë‹¹ ì´ë¯¸ì§€ í‘œì‹œ<br>
                        ğŸ”˜ í† ê¸€ë¡œ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì§€ ì•Šê³  ì¼ì‹œì ìœ¼ë¡œ ëŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    </p>

                    <div class="form-group">
                        <label>ì œëª© (ì„ íƒ)</label>
                        <textarea id="bannerTitle" placeholder="ë°°ë„ˆì— í‘œì‹œí•  ì œëª©" rows="2" style="resize: vertical;"></textarea>
                    </div>

                    <div class="form-group">
                        <label>ë¶€ì œëª© (ì„ íƒ)</label>
                        <textarea id="bannerSubtitle" placeholder="ë°°ë„ˆì— í‘œì‹œí•  ë¶€ì œëª©" rows="2" style="resize: vertical;"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ë§í¬ URL (ì„ íƒ)</label>
                            <input type="text" id="bannerLinkUrl" placeholder="https://...">
                        </div>
                        <div class="form-group">
                            <label>ë²„íŠ¼ í…ìŠ¤íŠ¸</label>
                            <input type="text" id="bannerLinkText" placeholder="ìì„¸íˆ ë³´ê¸°" value="ìì„¸íˆ ë³´ê¸°">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ì¶œì²˜ í‘œê¸° (ì„ íƒ)</label>
                        <input type="text" id="bannerSource" placeholder="ì˜ˆ: Â© ììœ ì™€í˜ì‹ , ì‚¬ì§„: í™ê¸¸ë™">
                        <p style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">ì´ë¯¸ì§€ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— ì‘ì€ ê¸€ì”¨ë¡œ í‘œì‹œë©ë‹ˆë‹¤</p>
                    </div>

                    <div class="form-group">
                        <label>ì¶œì²˜ í…ìŠ¤íŠ¸ ìƒ‰ìƒ</label>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="radio" name="sourceColor" value="white" checked>
                                <span style="padding: 4px 12px; background: #333; color: white; border-radius: 4px; font-size: 12px;">í°ìƒ‰</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="radio" name="sourceColor" value="black">
                                <span style="padding: 4px 12px; background: #f0f0f0; color: black; border-radius: 4px; font-size: 12px;">ê²€ì •</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="radio" name="sourceColor" value="gray">
                                <span style="padding: 4px 12px; background: #e0e0e0; color: #666; border-radius: 4px; font-size: 12px;">íšŒìƒ‰</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="bannerActive" checked>
                            í™œì„±í™” (ë©”ì¸ í˜ì´ì§€ì— í‘œì‹œ)
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveBanner()">
                    <i class="fas fa-save"></i> ì €ì¥
                </button>
            </div>
        </div>
    </div>

    <script>
        let banners = [];
        let editingId = null;
        let selectedFile = null; // PCìš© íŒŒì¼
        let selectedMobileFile = null; // ëª¨ë°”ì¼ìš© íŒŒì¼
        let removeImageFlag = false; // PC ì´ë¯¸ì§€ ì‚­ì œ í”Œë˜ê·¸
        let removeMobileImageFlag = false; // ëª¨ë°”ì¼ ì´ë¯¸ì§€ ì‚­ì œ í”Œë˜ê·¸

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            loadBanners();
            loadSettings();
        });

        // ì´ë¯¸ì§€ ì‚­ì œ í•¨ìˆ˜
        function removeImage(type) {
            if (type === 'pc') {
                removeImageFlag = true;
                selectedFile = null;
                const imageUpload = document.getElementById('imageUpload');
                imageUpload.innerHTML = `
                    <i class="fas fa-desktop" style="font-size: 1.5rem; color: #ccc;"></i>
                    <p style="font-size: 0.9rem; color: #999;">ì´ë¯¸ì§€ ì‚­ì œë¨</p>
                    <p style="font-size: 0.75rem; color: #999;">í´ë¦­í•˜ì—¬ ë‹¤ì‹œ ì—…ë¡œë“œ</p>
                    <input type="file" id="imageInput" accept="image/*" onchange="previewImage(this, 'pc')">
                `;
                imageUpload.classList.remove('has-image');
                document.getElementById('removeImageBtn').style.display = 'none';
            } else {
                removeMobileImageFlag = true;
                selectedMobileFile = null;
                const mobileUpload = document.getElementById('mobileImageUpload');
                mobileUpload.innerHTML = `
                    <i class="fas fa-mobile-alt" style="font-size: 1.5rem; color: #ccc;"></i>
                    <p style="font-size: 0.9rem; color: #999;">ì´ë¯¸ì§€ ì‚­ì œë¨</p>
                    <p style="font-size: 0.75rem; color: #999;">í´ë¦­í•˜ì—¬ ë‹¤ì‹œ ì—…ë¡œë“œ</p>
                    <input type="file" id="mobileImageInput" accept="image/*" onchange="previewImage(this, 'mobile')">
                `;
                mobileUpload.classList.remove('has-image');
                document.getElementById('removeMobileImageBtn').style.display = 'none';
            }
        }

        // ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadSettings() {
            try {
                const response = await fetch(window.API_BASE + '/banners/settings');
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('randomOrderToggle').checked = result.data.randomOrder;
                }
            } catch (error) {
                console.error('ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì„¤ì • ì—…ë°ì´íŠ¸
        async function updateSettings() {
            const randomOrder = document.getElementById('randomOrderToggle').checked;
            
            try {
                const response = await fetch(window.API_BASE + '/banners/settings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ randomOrder })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(randomOrder ? 'ëœë¤ ìˆœì„œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ìˆœì„œëŒ€ë¡œ í‘œì‹œë©ë‹ˆë‹¤.', 'success');
                } else {
                    showAlert('ì„¤ì • ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ì„¤ì • ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                showAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë°°ë„ˆ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadBanners() {
            try {
                const response = await fetch(window.API_BASE + '/banners?all=true');
                const result = await response.json();
                
                if (result.success) {
                    banners = result.data;
                    renderBanners();
                } else {
                    showAlert('ë°°ë„ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ë°°ë„ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
                showAlert('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë°°ë„ˆ ëª©ë¡ ë Œë”ë§
        function renderBanners() {
            const container = document.getElementById('bannerList');
            
            if (banners.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-image"></i>
                        <p>ë“±ë¡ëœ ë°°ë„ˆê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <button class="btn btn-primary" onclick="openCreateModal()" style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i> ì²« ë°°ë„ˆ ì¶”ê°€í•˜ê¸°
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = banners.map((banner, index) => `
                <div class="banner-item ${banner.isActive ? '' : 'inactive'}">
                    <div class="banner-order">
                        <button onclick="moveBanner(${index}, -1)" ${index === 0 ? 'disabled' : ''}>
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <button onclick="moveBanner(${index}, 1)" ${index === banners.length - 1 ? 'disabled' : ''}>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                    <img src="${banner.imageUrl}" alt="${banner.title || 'ë°°ë„ˆ'}" class="banner-thumbnail">
                    <div class="banner-info">
                        <h3>${banner.title || '(ì œëª© ì—†ìŒ)'}</h3>
                        <p>${banner.subtitle || '(ë¶€ì œëª© ì—†ìŒ)'}</p>
                        <small>
                            ${banner.linkUrl ? 'ğŸ”— ë§í¬ ìˆìŒ' : 'ë§í¬ ì—†ìŒ'} Â· 
                            ${banner.isActive ? 'âœ… í™œì„±' : 'â¸ï¸ ë¹„í™œì„±'}
                        </small>
                    </div>
                    <div class="banner-actions">
                        <label class="toggle-switch">
                            <input type="checkbox" ${banner.isActive ? 'checked' : ''} onchange="toggleActive('${banner._id}', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                        <button class="btn btn-primary btn-sm" onclick="openEditModal('${banner._id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteBanner('${banner._id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ëª¨ë‹¬ ì—´ê¸° (ì¶”ê°€)
        function openCreateModal() {
            editingId = null;
            selectedFile = null;
            selectedMobileFile = null;
            removeImageFlag = false;
            removeMobileImageFlag = false;
            document.getElementById('modalTitle').textContent = 'ìƒˆ ë°°ë„ˆ ì¶”ê°€';
            document.getElementById('bannerForm').reset();
            document.getElementById('bannerLinkText').value = 'ìì„¸íˆ ë³´ê¸°';
            document.getElementById('bannerSource').value = '';
            document.querySelector('input[name="sourceColor"][value="white"]').checked = true;
            document.getElementById('bannerActive').checked = true;
            
            // PC ì´ë¯¸ì§€ ì´ˆê¸°í™”
            const imageUpload = document.getElementById('imageUpload');
            imageUpload.innerHTML = `
                <i class="fas fa-desktop" style="font-size: 1.5rem; color: #667eea;"></i>
                <p style="font-size: 0.9rem;">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                <p style="font-size: 0.75rem; color: #999;">ê¶Œì¥: 1380 x 591px (21:9)</p>
                <input type="file" id="imageInput" accept="image/*" onchange="previewImage(this, 'pc')">
            `;
            imageUpload.classList.remove('has-image');
            document.getElementById('removeImageBtn').style.display = 'none';
            document.getElementById('imageActiveToggle').style.display = 'none';
            document.getElementById('imageActiveCheckbox').checked = true;
            
            // ëª¨ë°”ì¼ ì´ë¯¸ì§€ ì´ˆê¸°í™”
            const mobileUpload = document.getElementById('mobileImageUpload');
            mobileUpload.innerHTML = `
                <i class="fas fa-mobile-alt" style="font-size: 1.5rem; color: #28a745;"></i>
                <p style="font-size: 0.9rem;">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                <p style="font-size: 0.75rem; color: #999;">ê¶Œì¥: 800 x 1000px (4:5)</p>
                <input type="file" id="mobileImageInput" accept="image/*" onchange="previewImage(this, 'mobile')">
            `;
            mobileUpload.classList.remove('has-image');
            document.getElementById('removeMobileImageBtn').style.display = 'none';
            document.getElementById('mobileImageActiveToggle').style.display = 'none';
            document.getElementById('mobileImageActiveCheckbox').checked = true;
            
            document.getElementById('bannerModal').classList.add('active');
        }

        // ëª¨ë‹¬ ì—´ê¸° (ìˆ˜ì •)
        function openEditModal(id) {
            const banner = banners.find(b => b._id === id);
            if (!banner) return;

            editingId = id;
            selectedFile = null;
            selectedMobileFile = null;
            removeImageFlag = false;
            removeMobileImageFlag = false;
            document.getElementById('modalTitle').textContent = 'ë°°ë„ˆ ìˆ˜ì •';
            document.getElementById('bannerId').value = id;
            document.getElementById('bannerTitle').value = banner.title || '';
            document.getElementById('bannerSubtitle').value = banner.subtitle || '';
            document.getElementById('bannerLinkUrl').value = banner.linkUrl || '';
            document.getElementById('bannerLinkText').value = banner.linkText || 'ìì„¸íˆ ë³´ê¸°';
            document.getElementById('bannerSource').value = banner.source || '';
            const sourceColor = banner.sourceColor || 'white';
            document.querySelector(`input[name="sourceColor"][value="${sourceColor}"]`).checked = true;
            document.getElementById('bannerActive').checked = banner.isActive;

            // PC ì´ë¯¸ì§€ í‘œì‹œ
            const imageUpload = document.getElementById('imageUpload');
            if (banner.imageUrl) {
                imageUpload.innerHTML = `
                    <img src="${banner.imageUrl}" alt="PC ì´ë¯¸ì§€" style="${banner.imageActive === false ? 'opacity: 0.4;' : ''}">
                    <p style="font-size: 0.75rem; color: #666; margin-top: 0.5rem;">í´ë¦­í•˜ì—¬ ë³€ê²½</p>
                    <input type="file" id="imageInput" accept="image/*" onchange="previewImage(this, 'pc')">
                `;
                imageUpload.classList.add('has-image');
                document.getElementById('removeImageBtn').style.display = 'block';
                document.getElementById('imageActiveToggle').style.display = 'flex';
                document.getElementById('imageActiveCheckbox').checked = banner.imageActive !== false;
            } else {
                imageUpload.innerHTML = `
                    <i class="fas fa-desktop" style="font-size: 1.5rem; color: #667eea;"></i>
                    <p style="font-size: 0.9rem;">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                    <p style="font-size: 0.75rem; color: #999;">ê¶Œì¥: 1380 x 591px (21:9)</p>
                    <input type="file" id="imageInput" accept="image/*" onchange="previewImage(this, 'pc')">
                `;
                imageUpload.classList.remove('has-image');
                document.getElementById('removeImageBtn').style.display = 'none';
                document.getElementById('imageActiveToggle').style.display = 'none';
            }
            
            // ëª¨ë°”ì¼ ì´ë¯¸ì§€ í‘œì‹œ
            const mobileUpload = document.getElementById('mobileImageUpload');
            if (banner.mobileImageUrl) {
                mobileUpload.innerHTML = `
                    <img src="${banner.mobileImageUrl}" alt="ëª¨ë°”ì¼ ì´ë¯¸ì§€" style="${banner.mobileImageActive === false ? 'opacity: 0.4;' : ''}">
                    <p style="font-size: 0.75rem; color: #666; margin-top: 0.5rem;">í´ë¦­í•˜ì—¬ ë³€ê²½</p>
                    <input type="file" id="mobileImageInput" accept="image/*" onchange="previewImage(this, 'mobile')">
                `;
                mobileUpload.classList.add('has-image');
                document.getElementById('removeMobileImageBtn').style.display = 'block';
                document.getElementById('mobileImageActiveToggle').style.display = 'flex';
                document.getElementById('mobileImageActiveCheckbox').checked = banner.mobileImageActive !== false;
            } else {
                mobileUpload.innerHTML = `
                    <i class="fas fa-mobile-alt" style="font-size: 1.5rem; color: #28a745;"></i>
                    <p style="font-size: 0.9rem;">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                    <p style="font-size: 0.75rem; color: #999;">ê¶Œì¥: 800 x 1000px (4:5)</p>
                    <input type="file" id="mobileImageInput" accept="image/*" onchange="previewImage(this, 'mobile')">
                `;
                mobileUpload.classList.remove('has-image');
                document.getElementById('removeMobileImageBtn').style.display = 'none';
                document.getElementById('mobileImageActiveToggle').style.display = 'none';
            }

            document.getElementById('bannerModal').classList.add('active');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('bannerModal').classList.remove('active');
            editingId = null;
            selectedFile = null;
            selectedMobileFile = null;
            removeImageFlag = false;
            removeMobileImageFlag = false;
        }

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        function previewImage(input, type) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                if (type === 'pc') {
                    selectedFile = input.files[0];
                    removeImageFlag = false;
                    reader.onload = function(e) {
                        const imageUpload = document.getElementById('imageUpload');
                        imageUpload.innerHTML = `
                            <img src="${e.target.result}" alt="PC ë¯¸ë¦¬ë³´ê¸°">
                            <p style="font-size: 0.75rem; color: #666; margin-top: 0.5rem;">í´ë¦­í•˜ì—¬ ë³€ê²½</p>
                            <input type="file" id="imageInput" accept="image/*" onchange="previewImage(this, 'pc')">
                        `;
                        imageUpload.classList.add('has-image');
                        document.getElementById('removeImageBtn').style.display = 'block';
                        document.getElementById('imageActiveToggle').style.display = 'flex';
                        document.getElementById('imageActiveCheckbox').checked = true;
                    };
                } else {
                    selectedMobileFile = input.files[0];
                    removeMobileImageFlag = false;
                    reader.onload = function(e) {
                        const mobileUpload = document.getElementById('mobileImageUpload');
                        mobileUpload.innerHTML = `
                            <img src="${e.target.result}" alt="ëª¨ë°”ì¼ ë¯¸ë¦¬ë³´ê¸°">
                            <p style="font-size: 0.75rem; color: #666; margin-top: 0.5rem;">í´ë¦­í•˜ì—¬ ë³€ê²½</p>
                            <input type="file" id="mobileImageInput" accept="image/*" onchange="previewImage(this, 'mobile')">
                        `;
                        mobileUpload.classList.add('has-image');
                        document.getElementById('removeMobileImageBtn').style.display = 'block';
                        document.getElementById('mobileImageActiveToggle').style.display = 'flex';
                        document.getElementById('mobileImageActiveCheckbox').checked = true;
                    };
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // ë°°ë„ˆ ì €ì¥
        async function saveBanner() {
            const title = document.getElementById('bannerTitle').value;
            const subtitle = document.getElementById('bannerSubtitle').value;
            const linkUrl = document.getElementById('bannerLinkUrl').value;
            const linkText = document.getElementById('bannerLinkText').value;
            const source = document.getElementById('bannerSource').value;
            const sourceColor = document.querySelector('input[name="sourceColor"]:checked').value;
            const isActive = document.getElementById('bannerActive').checked;
            const imageActive = document.getElementById('imageActiveCheckbox').checked;
            const mobileImageActive = document.getElementById('mobileImageActiveCheckbox').checked;

            // ìƒˆ ë°°ë„ˆì¸ë° ì´ë¯¸ì§€ ë‘˜ ë‹¤ ì—†ìœ¼ë©´ ì—ëŸ¬
            if (!editingId && !selectedFile && !selectedMobileFile) {
                showAlert('PCìš© ë˜ëŠ” ëª¨ë°”ì¼ìš© ì´ë¯¸ì§€ ì¤‘ í•˜ë‚˜ëŠ” ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const formData = new FormData();
            
            // PC ì´ë¯¸ì§€ ì²˜ë¦¬
            if (selectedFile) {
                formData.append('image', selectedFile);
            }
            if (removeImageFlag) {
                formData.append('removeImage', 'true');
            }
            
            // ëª¨ë°”ì¼ ì´ë¯¸ì§€ ì²˜ë¦¬
            if (selectedMobileFile) {
                formData.append('mobileImage', selectedMobileFile);
            }
            if (removeMobileImageFlag) {
                formData.append('removeMobileImage', 'true');
            }
            
            formData.append('title', title);
            formData.append('subtitle', subtitle);
            formData.append('linkUrl', linkUrl);
            formData.append('linkText', linkText);
            formData.append('source', source);
            formData.append('sourceColor', sourceColor);
            formData.append('isActive', isActive);
            formData.append('imageActive', imageActive);
            formData.append('mobileImageActive', mobileImageActive);
            formData.append('order', editingId ? banners.find(b => b._id === editingId).order : banners.length);

            try {
                const url = editingId 
                    ? `${window.API_BASE}/banners/${editingId}`
                    : `${window.API_BASE}/banners`;
                
                const response = await fetch(url, {
                    method: editingId ? 'PUT' : 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showAlert(editingId ? 'ë°°ë„ˆê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë°°ë„ˆê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    closeModal();
                    loadBanners();
                } else {
                    showAlert(result.message || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ë°°ë„ˆ ì €ì¥ ì˜¤ë¥˜:', error);
                showAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë°°ë„ˆ ì‚­ì œ
        async function deleteBanner(id) {
            if (!confirm('ì •ë§ ì´ ë°°ë„ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`${window.API_BASE}/banners/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('ë°°ë„ˆê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadBanners();
                } else {
                    showAlert(result.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ë°°ë„ˆ ì‚­ì œ ì˜¤ë¥˜:', error);
                showAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í™œì„±í™” í† ê¸€
        async function toggleActive(id, isActive) {
            try {
                const formData = new FormData();
                formData.append('isActive', isActive);

                const response = await fetch(`${window.API_BASE}/banners/${id}`, {
                    method: 'PUT',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showAlert(isActive ? 'ë°°ë„ˆê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë°°ë„ˆê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadBanners();
                } else {
                    showAlert(result.message || 'ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    loadBanners(); // ì›ë˜ ìƒíƒœë¡œ ë³µêµ¬
                }
            } catch (error) {
                console.error('í† ê¸€ ì˜¤ë¥˜:', error);
                showAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                loadBanners();
            }
        }

        // ë°°ë„ˆ ìˆœì„œ ì´ë™
        async function moveBanner(index, direction) {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= banners.length) return;

            // ë°°ì—´ì—ì„œ ìˆœì„œ êµì²´
            [banners[index], banners[newIndex]] = [banners[newIndex], banners[index]];

            // ìˆœì„œ ì—…ë°ì´íŠ¸
            const orders = banners.map((banner, i) => ({
                id: banner._id,
                order: i
            }));

            try {
                const response = await fetch(`${window.API_BASE}/banners/reorder/bulk`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ orders })
                });

                const result = await response.json();

                if (result.success) {
                    renderBanners();
                } else {
                    showAlert('ìˆœì„œ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    loadBanners();
                }
            } catch (error) {
                console.error('ìˆœì„œ ë³€ê²½ ì˜¤ë¥˜:', error);
                showAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                loadBanners();
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            container.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }
    </script>
</body>
</html>
