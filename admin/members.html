<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì› ê´€ë¦¬ - ììœ ì™€í˜ì‹  ê´€ë¦¬ì</title>
    <script src="/config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#A50034',
                        'primary-dark': '#8B002C',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            background-attachment: fixed;
        }
        .nav-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .content-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .stat-card.active {
            border-color: #A50034;
            background: #fef2f2;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.625rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-pending { background: #fef3c7; color: #92400e; }
        .badge-active { background: #d1fae5; color: #065f46; }
        .badge-suspended { background: #fee2e2; color: #991b1b; }
        .badge-withdrawn { background: #e5e7eb; color: #374151; }
        .badge-party { background: #fce7f3; color: #9d174d; }
        .badge-general { background: #f3f4f6; color: #4b5563; }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary { background: #A50034; color: white; }
        .btn-primary:hover { background: #8B002C; }
        .btn-secondary { background: #f3f4f6; color: #374151; }
        .btn-secondary:hover { background: #e5e7eb; }
        .btn-success { background: #059669; color: white; }
        .btn-success:hover { background: #047857; }
        .btn-danger { background: #dc2626; color: white; }
        .btn-danger:hover { background: #b91c1c; }
        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        .form-input:focus {
            outline: none;
            border-color: #A50034;
            box-shadow: 0 0 0 2px rgba(165, 0, 52, 0.1);
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background: #f9fafb;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #6b7280;
        }
        tr:hover {
            background: #f9fafb;
        }
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .pagination {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1.5rem;
        }
        .pagination button {
            padding: 0.5rem 0.875rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            background: white;
            font-size: 0.875rem;
        }
        .pagination button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        .pagination button.active {
            background: #A50034;
            color: white;
            border-color: #A50034;
        }
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <!-- ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div id="admin-nav-container"></div>
    <script src="admin-nav.js"></script>
    <script>loadAdminNav('members');</script>

    <main class="min-h-screen pt-20 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- í—¤ë” -->
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-gray-900">ğŸ‘¥ íšŒì› ê´€ë¦¬</h1>
                <p class="text-gray-600 mt-1">íšŒì› ê°€ì… ìŠ¹ì¸ ë° ê´€ë¦¬</p>
            </div>

            <!-- í†µê³„ ì¹´ë“œ -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
                <div class="stat-card cursor-pointer" onclick="filterByStatus('')" id="stat-total">
                    <div class="text-2xl font-bold text-gray-900" id="count-total">0</div>
                    <div class="text-sm text-gray-500">ì „ì²´</div>
                </div>
                <div class="stat-card cursor-pointer" onclick="filterByStatus('pending')" id="stat-pending">
                    <div class="text-2xl font-bold text-yellow-600" id="count-pending">0</div>
                    <div class="text-sm text-gray-500">ìŠ¹ì¸ëŒ€ê¸°</div>
                </div>
                <div class="stat-card cursor-pointer" onclick="filterByStatus('active')" id="stat-active">
                    <div class="text-2xl font-bold text-green-600" id="count-active">0</div>
                    <div class="text-sm text-gray-500">ì •ìƒ</div>
                </div>
                <div class="stat-card cursor-pointer" onclick="filterByStatus('suspended')" id="stat-suspended">
                    <div class="text-2xl font-bold text-red-600" id="count-suspended">0</div>
                    <div class="text-sm text-gray-500">ì •ì§€</div>
                </div>
                <div class="stat-card cursor-pointer" onclick="filterByStatus('withdrawn')" id="stat-withdrawn">
                    <div class="text-2xl font-bold text-gray-500" id="count-withdrawn">0</div>
                    <div class="text-sm text-gray-500">íƒˆí‡´</div>
                </div>
                <div class="stat-card cursor-pointer" onclick="filterByType('party_member')" id="stat-party">
                    <div class="text-2xl font-bold text-pink-600" id="count-party">0</div>
                    <div class="text-sm text-gray-500">í˜ì‹ ë‹¹ì›</div>
                </div>
            </div>

            <!-- ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ -->
            <div id="pendingSection" class="content-card p-6 mb-8 hidden">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-yellow-700">
                        <i class="fas fa-clock mr-2"></i>ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ <span id="pendingCount" class="text-sm font-normal">(0ëª…)</span>
                    </h2>
                    <button onclick="bulkApprove()" class="btn btn-success text-sm">
                        <i class="fas fa-check-double mr-1"></i> ì „ì²´ ìŠ¹ì¸
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllPending" onchange="toggleSelectAll(this, 'pending')"></th>
                                <th>ì•„ì´ë””</th>
                                <th>ë‹‰ë„¤ì„</th>
                                <th>ì´ë¦„</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ì‹ ì²­ì¼</th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="pendingTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- ê²€ìƒ‰/í•„í„° -->
            <div class="content-card p-4 mb-6">
                <div class="flex flex-wrap gap-4 items-center">
                    <div class="flex-1 min-w-[200px]">
                        <div class="relative">
                            <input type="text" id="searchInput" class="form-input pl-10" placeholder="ì•„ì´ë””, ë‹‰ë„¤ì„, ì´ë¦„, ì´ë©”ì¼ ê²€ìƒ‰" onkeypress="if(event.key==='Enter') searchMembers()">
                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    <select id="statusFilter" class="form-input w-auto" onchange="applyFilters()">
                        <option value="">ì „ì²´ ìƒíƒœ</option>
                        <option value="pending">ìŠ¹ì¸ëŒ€ê¸°</option>
                        <option value="active">ì •ìƒ</option>
                        <option value="suspended">ì •ì§€</option>
                        <option value="withdrawn">íƒˆí‡´</option>
                    </select>
                    <select id="typeFilter" class="form-input w-auto" onchange="applyFilters()">
                        <option value="">ì „ì²´ ìœ í˜•</option>
                        <option value="general">ì¼ë°˜íšŒì›</option>
                        <option value="party_member">í˜ì‹ ë‹¹ì›</option>
                    </select>
                    <button onclick="searchMembers()" class="btn btn-primary">
                        <i class="fas fa-search mr-1"></i> ê²€ìƒ‰
                    </button>
                    <button onclick="resetFilters()" class="btn btn-secondary">
                        <i class="fas fa-redo mr-1"></i> ì´ˆê¸°í™”
                    </button>
                </div>
            </div>

            <!-- íšŒì› ëª©ë¡ -->
            <div class="content-card">
                <div class="p-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="font-semibold text-gray-900">íšŒì› ëª©ë¡</h2>
                        <span id="totalCount" class="text-sm text-gray-500">ì´ 0ëª…</span>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ì•„ì´ë””</th>
                                <th>ë‹‰ë„¤ì„</th>
                                <th>ì´ë¦„</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ìƒíƒœ</th>
                                <th>ìœ í˜•</th>
                                <th>ê°€ì…ì¼</th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="memberTableBody">
                            <tr>
                                <td colspan="8" class="text-center py-12 text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="pagination" class="pagination p-4"></div>
            </div>
        </div>
    </main>

    <!-- íšŒì› ìƒì„¸ ëª¨ë‹¬ -->
    <div id="memberModal" class="modal">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold">íšŒì› ìƒì„¸ ì •ë³´</h3>
                    <button onclick="closeModal('memberModal')" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="memberDetail"></div>
                <div id="memberActions" class="flex flex-wrap gap-2 mt-6 pt-4 border-t"></div>
            </div>
        </div>
    </div>

    <!-- ë°˜ë ¤ ì‚¬ìœ  ëª¨ë‹¬ -->
    <div id="rejectModal" class="modal">
        <div class="modal-content">
            <div class="p-6">
                <h3 class="text-lg font-bold mb-4">ê°€ì… ë°˜ë ¤</h3>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">ë°˜ë ¤ ì‚¬ìœ </label>
                    <textarea id="rejectReason" class="form-input" rows="3" placeholder="ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeModal('rejectModal')" class="flex-1 btn btn-secondary">ì·¨ì†Œ</button>
                    <button onclick="confirmReject()" class="flex-1 btn btn-danger">ë°˜ë ¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒíƒœ ë³€ê²½ ëª¨ë‹¬ -->
    <div id="statusModal" class="modal">
        <div class="modal-content">
            <div class="p-6">
                <h3 class="text-lg font-bold mb-4">ìƒíƒœ ë³€ê²½</h3>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">ë³€ê²½í•  ìƒíƒœ</label>
                    <select id="newStatus" class="form-input">
                        <option value="pending">ìŠ¹ì¸ëŒ€ê¸°</option>
                        <option value="active">ì •ìƒ</option>
                        <option value="suspended">ì •ì§€</option>
                        <option value="withdrawn">íƒˆí‡´</option>
                    </select>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeModal('statusModal')" class="flex-1 btn btn-secondary">ì·¨ì†Œ</button>
                    <button onclick="confirmStatusChange()" class="flex-1 btn btn-primary">ë³€ê²½</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì¸ì¦ ì²´í¬
        const token = localStorage.getItem('adminToken');
        const adminInfo = JSON.parse(localStorage.getItem('adminInfo') || '{}');
        
        if (!token) {
            window.location.href = 'index.html';
        }
        
        // ìƒíƒœ
        let currentPage = 1;
        let currentStatus = '';
        let currentType = '';
        let currentSearch = '';
        let selectedMemberId = null;
        let pendingMembers = [];
        
        // í˜ì´ì§€ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadPendingMembers();
            loadMembers();
        });
        
        // í†µê³„ ë¡œë“œ
        async function loadStats() {
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    document.getElementById('count-total').textContent = stats.total;
                    document.getElementById('count-pending').textContent = stats.pending;
                    document.getElementById('count-active').textContent = stats.active;
                    document.getElementById('count-suspended').textContent = stats.suspended;
                    document.getElementById('count-withdrawn').textContent = stats.withdrawn;
                    document.getElementById('count-party').textContent = stats.partyMembers;
                }
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ ë¡œë“œ
        async function loadPendingMembers() {
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/pending`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    pendingMembers = result.data;
                    document.getElementById('pendingSection').classList.remove('hidden');
                    document.getElementById('pendingCount').textContent = `(${result.data.length}ëª…)`;
                    renderPendingTable(result.data);
                } else {
                    document.getElementById('pendingSection').classList.add('hidden');
                }
            } catch (error) {
                console.error('ìŠ¹ì¸ ëŒ€ê¸° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ìŠ¹ì¸ ëŒ€ê¸° í…Œì´ë¸” ë Œë”ë§
        function renderPendingTable(members) {
            const tbody = document.getElementById('pendingTableBody');
            tbody.innerHTML = members.map(m => `
                <tr>
                    <td><input type="checkbox" class="pending-checkbox" value="${m._id}"></td>
                    <td class="font-medium">${m.userId}</td>
                    <td>${m.nickname}</td>
                    <td>${m.name}</td>
                    <td>${m.email}</td>
                    <td>${formatDate(m.appliedAt)}</td>
                    <td>
                        <div class="flex gap-2">
                            <button onclick="approveMember('${m._id}')" class="btn btn-success text-xs py-1 px-2">
                                <i class="fas fa-check mr-1"></i>ìŠ¹ì¸
                            </button>
                            <button onclick="openRejectModal('${m._id}')" class="btn btn-danger text-xs py-1 px-2">
                                <i class="fas fa-times mr-1"></i>ë°˜ë ¤
                            </button>
                            <button onclick="viewMember('${m._id}')" class="btn btn-secondary text-xs py-1 px-2">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // íšŒì› ëª©ë¡ ë¡œë“œ
        async function loadMembers() {
            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    limit: 20
                });
                if (currentStatus) params.append('status', currentStatus);
                if (currentType) params.append('memberType', currentType);
                if (currentSearch) params.append('search', currentSearch);
                
                const response = await fetch(`${window.API_BASE}/admin/members?${params}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                
                if (result.success) {
                    renderMemberTable(result.data.members);
                    renderPagination(result.data.pagination);
                    document.getElementById('totalCount').textContent = `ì´ ${result.data.pagination.total}ëª…`;
                }
            } catch (error) {
                console.error('íšŒì› ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('memberTableBody').innerHTML = `
                    <tr><td colspan="8" class="text-center py-12 text-red-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</td></tr>
                `;
            }
        }
        
        // íšŒì› í…Œì´ë¸” ë Œë”ë§
        function renderMemberTable(members) {
            const tbody = document.getElementById('memberTableBody');
            
            if (members.length === 0) {
                tbody.innerHTML = `
                    <tr><td colspan="8" class="text-center py-12 text-gray-500">
                        <i class="fas fa-users text-4xl mb-2 opacity-30"></i>
                        <p>íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </td></tr>
                `;
                return;
            }
            
            tbody.innerHTML = members.map(m => `
                <tr>
                    <td class="font-medium">${m.userId}</td>
                    <td>${m.nickname}</td>
                    <td>${m.name}</td>
                    <td class="text-sm text-gray-500">${m.email}</td>
                    <td>${getStatusBadge(m.status)}</td>
                    <td>${getTypeBadge(m.memberType)}</td>
                    <td class="text-sm text-gray-500">${formatDate(m.appliedAt)}</td>
                    <td>
                        <div class="flex gap-1">
                            <button onclick="viewMember('${m._id}')" class="btn btn-secondary text-xs py-1 px-2" title="ìƒì„¸ë³´ê¸°">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${m.status === 'pending' ? `
                                <button onclick="approveMember('${m._id}')" class="btn btn-success text-xs py-1 px-2" title="ìŠ¹ì¸">
                                    <i class="fas fa-check"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
        function renderPagination(pagination) {
            const container = document.getElementById('pagination');
            const { page, totalPages } = pagination;
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            html += `<button onclick="goToPage(${page - 1})" ${page === 1 ? 'disabled' : ''}><i class="fas fa-chevron-left"></i></button>`;
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= page - 2 && i <= page + 2)) {
                    html += `<button onclick="goToPage(${i})" class="${i === page ? 'active' : ''}">${i}</button>`;
                } else if (i === page - 3 || i === page + 3) {
                    html += `<span class="px-2">...</span>`;
                }
            }
            
            html += `<button onclick="goToPage(${page + 1})" ${page === totalPages ? 'disabled' : ''}><i class="fas fa-chevron-right"></i></button>`;
            
            container.innerHTML = html;
        }
        
        // í˜ì´ì§€ ì´ë™
        function goToPage(page) {
            currentPage = page;
            loadMembers();
        }
        
        // í•„í„° ì ìš©
        function applyFilters() {
            currentStatus = document.getElementById('statusFilter').value;
            currentType = document.getElementById('typeFilter').value;
            currentPage = 1;
            loadMembers();
            updateStatCards();
        }
        
        // ê²€ìƒ‰
        function searchMembers() {
            currentSearch = document.getElementById('searchInput').value.trim();
            currentPage = 1;
            loadMembers();
        }
        
        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('typeFilter').value = '';
            currentStatus = '';
            currentType = '';
            currentSearch = '';
            currentPage = 1;
            loadMembers();
            updateStatCards();
        }
        
        // ìƒíƒœë³„ í•„í„°
        function filterByStatus(status) {
            document.getElementById('statusFilter').value = status;
            document.getElementById('typeFilter').value = '';
            currentStatus = status;
            currentType = '';
            currentPage = 1;
            loadMembers();
            updateStatCards();
        }
        
        // ìœ í˜•ë³„ í•„í„°
        function filterByType(type) {
            document.getElementById('typeFilter').value = type;
            document.getElementById('statusFilter').value = '';
            currentType = type;
            currentStatus = '';
            currentPage = 1;
            loadMembers();
            updateStatCards();
        }
        
        // í†µê³„ ì¹´ë“œ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatCards() {
            document.querySelectorAll('.stat-card').forEach(card => card.classList.remove('active'));
            if (currentStatus) {
                document.getElementById('stat-' + currentStatus)?.classList.add('active');
            } else if (currentType === 'party_member') {
                document.getElementById('stat-party')?.classList.add('active');
            } else if (!currentStatus && !currentType) {
                document.getElementById('stat-total')?.classList.add('active');
            }
        }
        
        // íšŒì› ìƒì„¸ ë³´ê¸°
        async function viewMember(id) {
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/${id}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                
                if (result.success) {
                    const m = result.data;
                    selectedMemberId = id;
                    
                    document.getElementById('memberDetail').innerHTML = `
                        <div class="space-y-3">
                            <div class="flex items-center gap-3 pb-4 border-b">
                                <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-gray-400"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-lg">${m.nickname}</div>
                                    <div class="text-sm text-gray-500">@${m.userId}</div>
                                </div>
                                <div class="ml-auto flex gap-2">
                                    ${getStatusBadge(m.status)}
                                    ${getTypeBadge(m.memberType)}
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div><span class="text-gray-500">ì´ë¦„:</span> ${m.name}</div>
                                <div><span class="text-gray-500">ì—°ë½ì²˜:</span> ${m.phone}</div>
                                <div class="col-span-2"><span class="text-gray-500">ì´ë©”ì¼:</span> ${m.email}</div>
                                <div class="col-span-2"><span class="text-gray-500">ì£¼ì†Œ:</span> ${m.address || '-'} ${m.addressDetail || ''}</div>
                                <div><span class="text-gray-500">ê°€ì…ì‹ ì²­:</span> ${formatDateTime(m.appliedAt)}</div>
                                <div><span class="text-gray-500">ìŠ¹ì¸ì¼:</span> ${m.approvedAt ? formatDateTime(m.approvedAt) : '-'}</div>
                                <div><span class="text-gray-500">ë§ˆì§€ë§‰ ë¡œê·¸ì¸:</span> ${m.lastLoginAt ? formatDateTime(m.lastLoginAt) : '-'}</div>
                                <div><span class="text-gray-500">ë¡œê·¸ì¸ íšŸìˆ˜:</span> ${m.loginCount || 0}íšŒ</div>
                            </div>
                            ${m.happyNanum?.isLinked ? `
                                <div class="bg-pink-50 rounded-lg p-3 mt-4">
                                    <div class="font-semibold text-pink-700 mb-2">í•´í”¼ë‚˜ëˆ” ì—°ë™</div>
                                    <div class="text-sm text-gray-600">íšŒì›ë²ˆí˜¸: ${m.happyNanum.memberId}</div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    // ì‘ì—… ë²„íŠ¼
                    let actions = '';
                    if (m.status === 'pending') {
                        actions += `<button onclick="approveMember('${id}')" class="btn btn-success"><i class="fas fa-check mr-1"></i>ìŠ¹ì¸</button>`;
                        actions += `<button onclick="openRejectModal('${id}')" class="btn btn-danger"><i class="fas fa-times mr-1"></i>ë°˜ë ¤</button>`;
                    } else {
                        actions += `<button onclick="openStatusModal('${id}')" class="btn btn-secondary"><i class="fas fa-exchange-alt mr-1"></i>ìƒíƒœë³€ê²½</button>`;
                        if (m.memberType === 'general') {
                            actions += `<button onclick="changeMemberType('${id}', 'party_member')" class="btn btn-primary"><i class="fas fa-user-plus mr-1"></i>ë‹¹ì› ì „í™˜</button>`;
                        } else {
                            actions += `<button onclick="changeMemberType('${id}', 'general')" class="btn btn-secondary"><i class="fas fa-user-minus mr-1"></i>ì¼ë°˜ ì „í™˜</button>`;
                        }
                    }
                    actions += `<button onclick="deleteMember('${id}')" class="btn btn-danger"><i class="fas fa-trash mr-1"></i>ì‚­ì œ</button>`;
                    
                    document.getElementById('memberActions').innerHTML = actions;
                    document.getElementById('memberModal').classList.add('active');
                }
            } catch (error) {
                console.error('íšŒì› ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜:', error);
                alert('íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ê°€ì… ìŠ¹ì¸
        async function approveMember(id) {
            if (!confirm('ì´ íšŒì›ì˜ ê°€ì…ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/${id}/approve`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('ê°€ì…ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeModal('memberModal');
                    loadStats();
                    loadPendingMembers();
                    loadMembers();
                } else {
                    alert(result.message || 'ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ë°˜ë ¤ ëª¨ë‹¬ ì—´ê¸°
        function openRejectModal(id) {
            selectedMemberId = id;
            document.getElementById('rejectReason').value = '';
            document.getElementById('rejectModal').classList.add('active');
        }
        
        // ë°˜ë ¤ í™•ì¸
        async function confirmReject() {
            const reason = document.getElementById('rejectReason').value.trim();
            
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/${selectedMemberId}/reject`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ reason })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('ê°€ì…ì´ ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeModal('rejectModal');
                    closeModal('memberModal');
                    loadStats();
                    loadPendingMembers();
                    loadMembers();
                } else {
                    alert(result.message || 'ë°˜ë ¤ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ë°˜ë ¤ ì˜¤ë¥˜:', error);
                alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ì¼ê´„ ìŠ¹ì¸
        async function bulkApprove() {
            const checkboxes = document.querySelectorAll('.pending-checkbox:checked');
            const ids = Array.from(checkboxes).map(cb => cb.value);
            
            if (ids.length === 0) {
                alert('ìŠ¹ì¸í•  íšŒì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            
            if (!confirm(`ì„ íƒí•œ ${ids.length}ëª…ì˜ ê°€ì…ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/bulk-approve`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ memberIds: ids })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert(`${result.data.approvedCount}ëª…ì˜ ê°€ì…ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤`);
                    loadStats();
                    loadPendingMembers();
                    loadMembers();
                } else {
                    alert(result.message || 'ì¼ê´„ ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ì¼ê´„ ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ì „ì²´ ì„ íƒ í† ê¸€
        function toggleSelectAll(checkbox, type) {
            const checkboxes = document.querySelectorAll(`.${type}-checkbox`);
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
        }
        
        // ìƒíƒœ ë³€ê²½ ëª¨ë‹¬
        function openStatusModal(id) {
            selectedMemberId = id;
            document.getElementById('statusModal').classList.add('active');
        }
        
        // ìƒíƒœ ë³€ê²½ í™•ì¸
        async function confirmStatusChange() {
            const newStatus = document.getElementById('newStatus').value;
            
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/${selectedMemberId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeModal('statusModal');
                    closeModal('memberModal');
                    loadStats();
                    loadMembers();
                } else {
                    alert(result.message || 'ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // íšŒì› ìœ í˜• ë³€ê²½
        async function changeMemberType(id, newType) {
            const typeName = newType === 'party_member' ? 'í˜ì‹ ë‹¹ì›' : 'ì¼ë°˜íšŒì›';
            if (!confirm(`ì´ íšŒì›ì„ ${typeName}(ìœ¼)ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/${id}/member-type`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ memberType: newType })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('íšŒì› ìœ í˜•ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeModal('memberModal');
                    loadStats();
                    loadMembers();
                } else {
                    alert(result.message || 'ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ìœ í˜• ë³€ê²½ ì˜¤ë¥˜:', error);
                alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // íšŒì› ì‚­ì œ
        async function deleteMember(id) {
            if (!confirm('ì •ë§ ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
            if (!confirm('íšŒì› ë°ì´í„°ê°€ ì™„ì „íˆ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch(`${window.API_BASE}/admin/members/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeModal('memberModal');
                    loadStats();
                    loadPendingMembers();
                    loadMembers();
                } else {
                    alert(result.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function getStatusBadge(status) {
            const badges = {
                pending: '<span class="badge badge-pending">ìŠ¹ì¸ëŒ€ê¸°</span>',
                active: '<span class="badge badge-active">ì •ìƒ</span>',
                suspended: '<span class="badge badge-suspended">ì •ì§€</span>',
                withdrawn: '<span class="badge badge-withdrawn">íƒˆí‡´</span>'
            };
            return badges[status] || status;
        }
        
        function getTypeBadge(type) {
            return type === 'party_member' 
                ? '<span class="badge badge-party">í˜ì‹ ë‹¹ì›</span>'
                : '<span class="badge badge-general">ì¼ë°˜</span>';
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
        }
        
        function formatDateTime(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return `${formatDate(dateStr)} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }
        
        // logout í•¨ìˆ˜ëŠ” admin-nav.jsì—ì„œ ì •ì˜ë¨
    </script>
</body>
</html>
