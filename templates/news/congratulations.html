<!DOCTYPE html>
<html lang="{{lang_code}}">
<head>
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E0H9DY9T0F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E0H9DY9T0F');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{congratulations_title}}</title>
    
    <!-- SEO 메타 태그 -->
    <meta name="description" content="자유와혁신 당원들의 경조사 소식을 전합니다. 축하와 조의의 마음을 함께 나눕니다.">
    <meta name="keywords" content="자유와혁신, 경조사, 축하, 조의, 당원소식">
    <meta name="author" content="자유와혁신">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://forthefreedom.kr/news/congratulations.html">
    
    <!-- 파비콘 설정 -->
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon.png">
    <link rel="shortcut icon" type="image/png" href="../images/favicon.png">
    <link rel="icon" href="../images/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'red-600': '#A50034',
                        'red-700': '#8B002C',
                        'red-800': '#700024',
                        'red-900': '#56001C',
                        'red-50': '#FDF2F4',
                        'red-100': '#FCE7EA',
                        'red-500': '#A50034'
                    }
                }
            }
        }
    </script>
    <style>
        .text-red-600 { color: #A50034 !important; }
        .bg-red-600 { background-color: #A50034 !important; }
        .border-red-600 { border-color: #A50034 !important; }
        .hover\:bg-red-700:hover { background-color: #8B002C !important; }
        .hover\:text-red-600:hover { color: #A50034 !important; }
        .hover\:text-red-700:hover { color: #8B002C !important; }
        .hover\:border-red-600:hover { border-color: #A50034 !important; }
        .bg-red-50 { background-color: #FDF2F4 !important; }
        .bg-red-100 { background-color: #FCE7EA !important; }
        .text-red-800 { color: #700024 !important; }
        .border-l-4.border-red-600 { border-left-color: #A50034 !important; }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #A50034;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #e5e7eb;
            background: white;
            color: #374151;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            border-color: #A50034;
            color: #A50034;
        }
        
        .filter-btn.active {
            background: #A50034;
            color: white;
            border-color: #A50034;
        }
        
        .congrats-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 24px;
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }
        
        .congrats-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .congrats-card.celebration {
            border-left-color: #f59e0b;
        }
        
        .congrats-card.condolence {
            border-left-color: #6b7280;
        }
        
        .badge-celebration {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-condolence {
            background: #f3f4f6;
            color: #374151;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <script src="/analytics.js"></script>
</head>
<body>
    <div id="navigation-container"></div>
    
    <!-- 브레드크럼 -->
    <section class="bg-gray-50 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="text-sm">
                <ol class="list-none p-0 inline-flex space-x-2">
                    <li class="flex items-center">
                        <a href="../index.html" class="text-gray-500 hover:text-red-600">홈</a>
                        <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    </li>
                    <li class="flex items-center">
                        <a href="../news.html" class="text-gray-500 hover:text-red-600">정당소식</a>
                        <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    </li>
                    <li class="text-gray-900">경조사</li>
                </ol>
            </nav>
        </div>
    </section>

    <main class="bg-white">
        <section class="py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- 페이지 헤더 -->
                <div class="text-center mb-12">
                    <h1 class="text-4xl font-bold text-gray-900 mb-4">경조사</h1>
                    <p class="text-xl text-gray-600">당원 여러분의 기쁨과 슬픔을 함께 나눕니다</p>
                </div>

                <!-- 필터 버튼 -->
                <div class="mb-6 flex flex-wrap gap-3 justify-center">
                    <button class="filter-btn active" data-category="">
                        <i class="fas fa-list mr-2"></i>전체
                    </button>
                    <button class="filter-btn" data-category="경사">
                        <i class="fas fa-gift mr-2"></i>경사
                    </button>
                    <button class="filter-btn" data-category="조사">
                        <i class="fas fa-ribbon mr-2"></i>조사
                    </button>
                </div>

                <!-- 검색 -->
                <div class="mb-8 max-w-xl mx-auto">
                    <div class="flex gap-2">
                        <input type="text" id="searchInput" 
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                            placeholder="이름, 내용 등으로 검색..."
                            onkeypress="if(event.key==='Enter') doSearch()">
                        <button onclick="doSearch()" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <!-- 로딩 -->
                <div id="loading" class="text-center py-12">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-500">경조사 목록을 불러오는 중...</p>
                </div>

                <!-- 빈 상태 -->
                <div id="empty-state" class="text-center py-16 hidden">
                    <div class="text-gray-300 mb-4">
                        <i class="fas fa-heart text-6xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">등록된 경조사가 없습니다</h3>
                    <p class="text-gray-500">새로운 경조사 소식이 등록되면 여기에 표시됩니다.</p>
                </div>

                <!-- 경조사 목록 -->
                <div id="congrats-list" class="space-y-4 hidden">
                    <!-- 동적으로 생성됨 -->
                </div>

                <!-- 페이지네이션 -->
                <div id="pagination" class="mt-12 flex justify-center hidden">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>
        </section>
    </main>

    <!-- 푸터 -->
    <div id="footer-container"></div>

    <script>
        window.API_BASE = 'https://forthefreedom-kr-production.up.railway.app/api';
    </script>
    <script src="../nav.js"></script>
    <script src="../footer.js"></script>
    
    <script>
        let currentPage = 1;
        let currentCategory = '';
        let currentSearch = '';
        const itemsPerPage = 10;
        
        // 페이지 로드 시
        document.addEventListener('DOMContentLoaded', () => {
            loadCongratulations();
            setupFilterButtons();
        });
        
        // 검색 실행
        function doSearch() {
            currentSearch = document.getElementById('searchInput').value.trim();
            currentPage = 1;
            loadCongratulations();
        }
        
        // 필터 버튼 설정
        function setupFilterButtons() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    currentPage = 1;
                    loadCongratulations();
                });
            });
        }
        
        // 경조사 목록 로드
        async function loadCongratulations() {
            const loading = document.getElementById('loading');
            const emptyState = document.getElementById('empty-state');
            const congratsList = document.getElementById('congrats-list');
            const pagination = document.getElementById('pagination');
            
            loading.classList.remove('hidden');
            emptyState.classList.add('hidden');
            congratsList.classList.add('hidden');
            pagination.classList.add('hidden');
            
            try {
                let url = `${window.API_BASE}/congratulations?page=${currentPage}&limit=${itemsPerPage}`;
                if (currentCategory) {
                    url += `&category=${encodeURIComponent(currentCategory)}`;
                }
                if (currentSearch) {
                    url += `&search=${encodeURIComponent(currentSearch)}`;
                }
                
                const response = await fetch(url);
                const result = await response.json();
                
                loading.classList.add('hidden');
                
                if (result.success && result.data && result.data.length > 0) {
                    renderCongratulations(result.data);
                    congratsList.classList.remove('hidden');
                    
                    if (result.totalPages > 1) {
                        renderPagination(result.totalPages);
                        pagination.classList.remove('hidden');
                    }
                } else {
                    emptyState.classList.remove('hidden');
                }
            } catch (error) {
                console.error('경조사 로드 실패:', error);
                loading.classList.add('hidden');
                emptyState.classList.remove('hidden');
            }
        }
        
        // 경조사 목록 렌더링
        function renderCongratulations(items) {
            const container = document.getElementById('congrats-list');
            container.innerHTML = items.map(item => {
                const isCelebration = item.category === '경사';
                const cardClass = isCelebration ? 'celebration' : 'condolence';
                const badgeClass = isCelebration ? 'badge-celebration' : 'badge-condolence';
                const icon = isCelebration ? 'fa-gift' : 'fa-ribbon';
                
                return `
                    <div class="congrats-card ${cardClass}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${badgeClass}">
                                        <i class="fas ${icon} mr-1"></i>
                                        ${item.category}
                                    </span>
                                    <span class="text-sm text-gray-500">${formatDate(item.createdAt)}</span>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 mb-2">${item.title}</h3>
                                <p class="text-gray-600">${item.content}</p>
                                ${item.targetPerson ? `<p class="mt-2 text-sm text-gray-500"><i class="fas fa-user mr-1"></i>${item.targetPerson}</p>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 날짜 포맷
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // 페이지네이션 렌더링
        function renderPagination(totalPages) {
            const container = document.getElementById('pagination');
            let html = '<div class="flex gap-2">';
            
            // 이전 버튼
            html += `
                <button onclick="goToPage(${currentPage - 1})" 
                    class="px-4 py-2 rounded-lg border ${currentPage === 1 ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-50'}"
                    ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // 페이지 번호
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<button class="px-4 py-2 rounded-lg bg-red-600 text-white">${i}</button>`;
                } else {
                    html += `<button onclick="goToPage(${i})" class="px-4 py-2 rounded-lg border bg-white text-gray-700 hover:bg-gray-50">${i}</button>`;
                }
            }
            
            // 다음 버튼
            html += `
                <button onclick="goToPage(${currentPage + 1})" 
                    class="px-4 py-2 rounded-lg border ${currentPage === totalPages ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-50'}"
                    ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // 페이지 이동
        function goToPage(page) {
            currentPage = page;
            loadCongratulations();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
