<!DOCTYPE html>
<html lang="{{lang_code}}">
<head>
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E0H9DY9T0F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E0H9DY9T0F');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{chapters_page_title}}</title>
    
    <!-- SEO 메타 태그 -->
    <meta name="description" content="자유와혁신 서울특별시당 각 당협위원회별 카카오톡 팀채팅 안내. 행정동 기준으로 해당 지역구를 찾아 참여하세요.">
    <meta name="keywords" content="자유와혁신, 당협위원회, 서울시당, 카카오톡, 지역구, 황교안">
    <meta name="author" content="자유와혁신">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://forthefreedom.kr/local-chapters.html">
    
    <!-- 파비콘 설정 -->
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicon.png">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png">
    <link rel="icon" href="images/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'red-600': '#A50034',
                        'red-700': '#8B002C',
                        'red-800': '#700024',
                        'red-900': '#56001C',
                        'red-50': '#FDF2F4',
                        'red-100': '#FCE7EA',
                        'red-500': '#A50034',
                        'kakao': '#FEE500'
                    }
                }
            }
        }
    </script>
    <style>
        .text-red-600 { color: #A50034 !important; }
        .bg-red-600 { background-color: #A50034 !important; }
        .border-red-600 { border-color: #A50034 !important; }
        .hover\:bg-red-700:hover { background-color: #8B002C !important; }
        
        .chapter-card {
            transition: all 0.2s ease;
        }
        .chapter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .chapter-card.highlight {
            border-color: #A50034 !important;
            background-color: #FDF2F4 !important;
        }
        .kakao-btn {
            background-color: #FEE500;
            color: #000000;
            transition: all 0.2s ease;
        }
        .kakao-btn:hover {
            background-color: #E6CF00;
        }
        .dong-tag {
            display: inline-block;
            background-color: #f3f4f6;
            color: #4b5563;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }
        .dong-tag.matched {
            background-color: #A50034;
            color: white;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/style.css">
    <script src="/analytics.js"></script>
</head>
<body>
    <div id="navigation-container"></div>
    
    <!-- 브레드크럼 -->
    <section class="bg-gray-50 py-8 mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="text-sm">
                <ol class="list-none p-0 inline-flex space-x-2">
                    <li class="flex items-center">
                        <a href="index.html" class="text-gray-500 hover:text-red-600">홈</a>
                        <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    </li>
                    <li class="text-gray-900">시도당·당협위원회 구성</li>
                </ol>
            </nav>
        </div>
    </section>

    <main class="bg-white">
        <!-- 페이지 제목 -->
        <div class="bg-white py-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h1 class="text-3xl font-bold text-gray-900">시도당·당협위원회</h1>
                </div>
            </div>
        </div>

        <!-- 시도당 탭 (항상 보임) -->
        <div class="bg-gray-50 border-b sticky top-20 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex flex-wrap justify-center gap-2" id="tabContainer">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>
        </div>

        <!-- 랜딩 섹션 (지도 + 카드) -->
        <section id="landingSection" class="py-12 hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-8">
                    <p class="text-gray-600">전국 17개 시·도 지역당부 현황</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- 왼쪽: 지도 -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 border">
                        <div class="flex justify-center gap-6 mb-4 text-sm">
                            <span class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-green-500"></span> 창당 완료</span>
                            <span class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-yellow-500"></span> 창당 임박</span>
                        </div>
                        
                        <!-- 대한민국 지도 SVG -->
                        <svg viewBox="0 0 800 900" class="w-full max-w-md mx-auto cursor-pointer">
                            <style>
                                .map-region { transition: all 0.2s; cursor: pointer; }
                                .map-region:hover { filter: brightness(0.9); }
                                .status-established { fill: #22c55e; stroke: #fff; stroke-width: 2; }
                                .status-preparing { fill: #eab308; stroke: #fff; stroke-width: 2; }
                                .status-inactive { fill: #e5e7eb; stroke: #fff; stroke-width: 2; }
                            </style>
                            <!-- 강원 -->
                            <path onclick="switchProvince('gangwon')" class="map-region status-inactive" d="M450,120 L550,100 L620,150 L600,250 L500,280 L420,240 L400,180 Z"><title>강원</title></path>
                            <!-- 경기 -->
                            <path onclick="switchProvince('gyeonggi')" class="map-region status-established" d="M300,180 L400,180 L420,240 L380,300 L300,320 L250,280 L260,200 Z"><title>경기</title></path>
                            <!-- 서울 -->
                            <path onclick="switchProvince('seoul')" class="map-region status-established" d="M320,220 L360,220 L370,250 L340,270 L310,250 Z"><title>서울</title></path>
                            <!-- 인천 -->
                            <path onclick="switchProvince('incheon')" class="map-region status-established" d="M250,220 L290,220 L300,260 L260,280 L230,250 Z"><title>인천</title></path>
                            <!-- 충북 -->
                            <path onclick="switchProvince('chungbuk')" class="map-region status-preparing" d="M380,300 L500,280 L520,350 L450,400 L350,380 L340,320 Z"><title>충북</title></path>
                            <!-- 세종 -->
                            <path onclick="switchProvince('sejong')" class="map-region status-inactive" d="M320,350 L350,350 L360,380 L330,400 L310,380 Z"><title>세종</title></path>
                            <!-- 대전 -->
                            <path onclick="switchProvince('daejeon')" class="map-region status-preparing" d="M350,380 L390,380 L400,420 L360,440 L340,410 Z"><title>대전</title></path>
                            <!-- 충남 -->
                            <path onclick="switchProvince('chungnam')" class="map-region status-preparing" d="M200,300 L300,320 L340,320 L350,380 L320,350 L310,380 L340,410 L300,450 L180,420 L160,350 Z"><title>충남</title></path>
                            <!-- 경북 -->
                            <path onclick="switchProvince('gyeongbuk')" class="map-region status-established" d="M500,280 L600,250 L650,350 L620,450 L500,480 L450,400 L520,350 Z"><title>경북</title></path>
                            <!-- 대구 -->
                            <path onclick="switchProvince('daegu')" class="map-region status-preparing" d="M520,420 L570,420 L580,470 L540,490 L510,460 Z"><title>대구</title></path>
                            <!-- 전북 -->
                            <path onclick="switchProvince('jeonbuk')" class="map-region status-inactive" d="M180,420 L300,450 L340,410 L360,440 L350,500 L280,530 L160,500 Z"><title>전북</title></path>
                            <!-- 전남 -->
                            <path onclick="switchProvince('jeonnam')" class="map-region status-inactive" d="M160,500 L280,530 L300,600 L250,680 L120,650 L100,550 Z"><title>전남</title></path>
                            <!-- 광주 -->
                            <path onclick="switchProvince('gwangju')" class="map-region status-inactive" d="M200,540 L250,540 L260,580 L220,600 L190,570 Z"><title>광주</title></path>
                            <!-- 경남 -->
                            <path onclick="switchProvince('gyeongnam')" class="map-region status-preparing" d="M350,500 L500,480 L540,490 L580,470 L600,550 L550,620 L400,600 L320,560 Z"><title>경남</title></path>
                            <!-- 울산 -->
                            <path onclick="switchProvince('ulsan')" class="map-region status-preparing" d="M580,470 L620,450 L650,500 L620,530 L590,500 Z"><title>울산</title></path>
                            <!-- 부산 -->
                            <path onclick="switchProvince('busan')" class="map-region status-established" d="M550,580 L600,550 L630,590 L600,630 L560,610 Z"><title>부산</title></path>
                            <!-- 제주 -->
                            <path onclick="switchProvince('jeju')" class="map-region status-preparing" d="M180,780 L300,780 L310,830 L170,830 Z"><title>제주</title></path>
                            
                            <!-- 지역 라벨 -->
                            <text x="340" y="250" class="text-xs font-bold fill-white pointer-events-none" style="font-size:14px;font-weight:bold;">서울</text>
                            <text x="330" y="270" class="text-xs font-bold fill-white pointer-events-none" style="font-size:14px;font-weight:bold;">경기</text>
                            <text x="260" y="255" class="text-xs font-bold fill-white pointer-events-none" style="font-size:14px;font-weight:bold;">인천</text>
                            <text x="510" y="190" class="text-xs font-bold fill-gray-500 pointer-events-none" style="font-size:14px;font-weight:bold;">강원</text>
                            <text x="430" y="350" class="text-xs font-bold fill-gray-700 pointer-events-none" style="font-size:14px;font-weight:bold;">충북</text>
                            <text x="240" y="385" class="text-xs font-bold fill-gray-700 pointer-events-none" style="font-size:14px;font-weight:bold;">충남</text>
                            <text x="335" y="375" class="text-xs font-bold fill-gray-500 pointer-events-none" style="font-size:14px;font-weight:bold;">세종</text>
                            <text x="368" y="415" class="text-xs font-bold fill-gray-700 pointer-events-none" style="font-size:14px;font-weight:bold;">대전</text>
                            <text x="555" y="365" class="text-xs font-bold fill-white pointer-events-none" style="font-size:14px;font-weight:bold;">경북</text>
                            <text x="545" y="458" class="text-xs font-bold fill-gray-700 pointer-events-none" style="font-size:14px;font-weight:bold;">대구</text>
                            <text x="260" y="480" class="text-xs font-bold fill-gray-500 pointer-events-none" style="font-size:14px;font-weight:bold;">전북</text>
                            <text x="200" y="600" class="text-xs font-bold fill-gray-500 pointer-events-none" style="font-size:14px;font-weight:bold;">전남</text>
                            <text x="223" y="573" class="text-xs font-bold fill-gray-500 pointer-events-none" style="font-size:14px;font-weight:bold;">광주</text>
                            <text x="460" y="555" class="text-xs font-bold fill-gray-700 pointer-events-none" style="font-size:14px;font-weight:bold;">경남</text>
                            <text x="610" y="495" class="text-xs font-bold fill-gray-700 pointer-events-none" style="font-size:14px;font-weight:bold;">울산</text>
                            <text x="590" y="600" class="text-xs font-bold fill-white pointer-events-none" style="font-size:14px;font-weight:bold;">부산</text>
                            <text x="240" y="810" class="text-xs font-bold fill-gray-700 pointer-events-none" style="font-size:14px;font-weight:bold;">제주</text>
                        </svg>
                    </div>

                    <!-- 오른쪽: 카드 목록 -->
                    <div class="space-y-6">
                        <!-- 창당 완료 -->
                        <div>
                            <h2 class="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-green-500"></span> 창당 완료
                            </h2>
                            <div class="grid sm:grid-cols-2 gap-3" id="establishedCards">
                                <!-- 동적으로 생성됨 -->
                            </div>
                        </div>

                        <!-- 창당 임박 -->
                        <div>
                            <h2 class="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-yellow-500"></span> 창당 임박
                            </h2>
                            <div class="grid sm:grid-cols-2 gap-3" id="preparingCards">
                                <!-- 동적으로 생성됨 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 기존 메인 콘텐츠 -->
        <section id="mainContent" class="py-16 hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- 공식 채널 섹션 -->
                <div id="officialChannelSection" class="mb-16">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-l-4 border-red-600 pl-4" id="officialChannelTitle">서울특별시당 공식 채널</h2>
                    
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4" id="officialChannelGrid">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>

                <!-- 당협위원회별 채팅방 섹션 -->
                <div id="chatRoomSection">
                    <!-- 분과위원회 섹션 -->
                    <div id="committeeSection" class="mb-16">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2 border-l-4 border-red-600 pl-4" id="committeeTitle">서울특별시당 분과위원회 채팅방</h2>
                        <p class="text-gray-600 mb-6 pl-5">당원 여러분의 적극적인 참여 부탁드립니다.</p>
                        
                        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4" id="committeeGrid">
                            <!-- 동적으로 생성됨 -->
                        </div>
                    </div>

                    <!-- 당협위원회별 채팅방 -->
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-l-4 border-red-600 pl-4" id="chatRoomTitle">서울특별시당 당협위원회별 채팅방</h2>
                    
                    <p class="text-base text-red-600 font-medium mb-6">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        자신의 도로명 주소가 아닌, <strong>행정동 단위</strong>로 구분하여 지역구를 선택하셔야 합니다.
                    </p>

                    <!-- 검색 영역 -->
                    <div class="mb-10 max-w-2xl mx-auto" id="searchArea">
                        <div class="relative">
                            <input type="text" id="searchInput" 
                                   placeholder="행정동 또는 구 이름을 입력하세요 (예: 역삼1동, 강남구, 송파)" 
                                   class="w-full px-5 py-4 pr-12 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 text-lg">
                            <button onclick="searchDong()" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <p id="searchResult" class="mt-3 text-center text-gray-600 hidden"></p>
                    </div>

                    <!-- 지역구 카드 목록 -->
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="chaptersContainer">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>
                
                <!-- 준비중 메시지 -->
                <div id="preparingMessage" class="hidden text-center py-20">
                    <div class="max-w-md mx-auto">
                        <i class="fas fa-hard-hat text-gray-400 text-6xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-gray-700 mb-4" id="preparingTitle">경기 시도당</h3>
                        <p class="text-gray-500 text-lg">당협위원회 구성 준비 중입니다.</p>
                        <p class="text-gray-400 mt-2">빠른 시일 내에 안내드리겠습니다.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="config.js"></script>
    <script src="nav.js"></script>
    <script src="footer.js"></script>
    <script>
        // 시도당 목록
        const provinces = [
            { id: 'seoul', name: '서울', fullName: '서울특별시당', hasData: true, status: 'established', leader: '최현욱', leaderTitle: '위원장' },
            { id: 'gyeonggi', name: '경기', fullName: '경기도당', hasData: false, status: 'established', leader: '조성범', leaderTitle: '위원장' },
            { id: 'incheon', name: '인천', fullName: '인천광역시당', hasData: false, status: 'established', leader: '권오용', leaderTitle: '위원장' },
            { id: 'busan', name: '부산', fullName: '부산광역시당', hasData: true, status: 'established', leader: '서미란', leaderTitle: '위원장' },
            { id: 'daegu', name: '대구', fullName: '대구광역시당', hasData: false, status: 'preparing', leader: '황현정', leaderTitle: '창준위원장' },
            { id: 'daejeon', name: '대전', fullName: '대전광역시당', hasData: false, status: 'preparing', leader: '김재훈', leaderTitle: '창준위원장' },
            { id: 'gwangju', name: '광주', fullName: '광주광역시당', hasData: false, status: 'inactive', leader: null, leaderTitle: null },
            { id: 'ulsan', name: '울산', fullName: '울산광역시당', hasData: false, status: 'preparing', leader: '지광선', leaderTitle: '창준위원장' },
            { id: 'sejong', name: '세종', fullName: '세종특별자치시당', hasData: false, status: 'inactive', leader: null, leaderTitle: null },
            { id: 'gangwon', name: '강원', fullName: '강원특별자치도당', hasData: false, status: 'inactive', leader: null, leaderTitle: null },
            { id: 'chungbuk', name: '충북', fullName: '충청북도당', hasData: false, status: 'preparing', leader: '김기현', leaderTitle: '창준위원장' },
            { id: 'chungnam', name: '충남', fullName: '충청남도당', hasData: false, status: 'preparing', leader: null, leaderTitle: null },
            { id: 'gyeongbuk', name: '경북', fullName: '경상북도당', hasData: true, status: 'established', leader: '차훈', leaderTitle: '위원장' },
            { id: 'gyeongnam', name: '경남', fullName: '경상남도당', hasData: false, status: 'preparing', leader: '김진일', leaderTitle: '창준위원장' },
            { id: 'jeonbuk', name: '전북', fullName: '전북특별자치도당', hasData: false, status: 'inactive', leader: null, leaderTitle: null },
            { id: 'jeonnam', name: '전남', fullName: '전라남도당', hasData: false, status: 'inactive', leader: null, leaderTitle: null },
            { id: 'jeju', name: '제주', fullName: '제주특별자치도당', hasData: false, status: 'preparing', leader: null, leaderTitle: null }
        ];

        let currentProvince = 'seoul';

        // 공식 채널 데이터
        const officialChannels = {
            seoul: {
                title: '서울특별시당 공식채널',
                committeeTitle: '서울특별시당 분과위원회 채팅방',
                chatTitle: '서울특별시당 당협위원회별 채팅방',
                channels: [
                    { name: '공식 문의 e-mail', value: 'seoul@freeinno.kr', type: 'email', icon: 'fas fa-envelope' },
                    { name: '공지 전용 카카오톡 오픈채팅방', value: 'https://open.kakao.com/o/gvs2bA5h', type: 'kakao', icon: 'fas fa-comment' },
                    { name: '네이버 블로그', value: '확보 예정', type: 'text', icon: 'fas fa-blog' },
                    { name: '인스타그램', value: 'https://www.instagram.com/freeinno_seoul', type: 'link', icon: 'fab fa-instagram' },
                    { name: '스레드', value: 'https://www.threads.com/@freeinno_seoul', type: 'link', icon: 'fas fa-at' },
                    { name: '엑스(구 트위터)', value: 'https://x.com/freeinno_seoul', type: 'link', icon: 'fab fa-x-twitter' },
                    { name: '페이스북', value: 'https://www.facebook.com/profile.php?id=61584750230843', type: 'link', icon: 'fab fa-facebook' },
                    { name: '유튜브 채널', value: 'https://www.youtube.com/@freeinno_seoul', type: 'link', icon: 'fab fa-youtube' },
                    { name: '디스코드(온라인 당사)', value: '필요시마다 링크 공유', type: 'text', icon: 'fab fa-discord' }
                ],
                committees: [
                    { name: '홍보분과', kakaoLink: 'https://invite.kakao.com/tc/otfoxuy2HS' },
                    { name: '조직강화분과', kakaoLink: 'https://invite.kakao.com/tc/3mS6hHHXby' },
                    { name: '정책분과', kakaoLink: 'https://invite.kakao.com/tc/V5Sw3TgOcl' },
                    { name: '투쟁분과', kakaoLink: 'https://invite.kakao.com/tc/HhMLfyDGMb' },
                    { name: '자원봉사단', kakaoLink: 'https://invite.kakao.com/tc/zeFFJuImTP' }
                ]
            },
            busan: {
                title: '부산광역시당 공식채널',
                committeeTitle: '부산광역시당 분과위원회 채팅방',
                chatTitle: '부산광역시당 당협위원회별 채팅방',
                channels: [
                    { name: '공식 문의 e-mail', value: 'busan@freeinno.kr', type: 'email', icon: 'fas fa-envelope' },
                    { name: '공지 전용 카카오톡 오픈채팅방', value: 'https://open.kakao.com/o/g8zkGj6h', type: 'kakao', icon: 'fas fa-comment' },
                    { name: '네이버 블로그', value: '공개 예정', type: 'text', icon: 'fas fa-blog' },
                    { name: '인스타그램', value: '공개 예정', type: 'text', icon: 'fab fa-instagram' },
                    { name: '스레드', value: '공개 예정', type: 'text', icon: 'fas fa-at' },
                    { name: '엑스(구 트위터)', value: '공개 예정', type: 'text', icon: 'fab fa-x-twitter' },
                    { name: '페이스북', value: '공개 예정', type: 'text', icon: 'fab fa-facebook' },
                    { name: '유튜브 채널', value: '공개 예정', type: 'text', icon: 'fab fa-youtube' },
                    { name: '디스코드(온라인 당사)', value: '공개 예정', type: 'text', icon: 'fab fa-discord' }
                ],
                committees: [
                    { name: '홍보분과', kakaoLink: null },
                    { name: '조직강화분과', kakaoLink: null },
                    { name: '정책분과', kakaoLink: null },
                    { name: '투쟁분과', kakaoLink: null },
                    { name: '자원봉사단', kakaoLink: null }
                ]
            },
            gyeongbuk: {
                title: '경상북도당 공식채널',
                committeeTitle: '경상북도당 분과위원회 채팅방',
                chatTitle: '경상북도당 당협위원회별 채팅방',
                channels: [
                    { name: '공식 문의 e-mail', value: 'gyeongbuk@freeinno.kr', type: 'email', icon: 'fas fa-envelope' },
                    { name: '공지 전용 카카오톡 오픈채팅방', value: 'https://open.kakao.com/o/gffKtR6h', type: 'kakao', icon: 'fas fa-comment' },
                    { name: '네이버 블로그', value: '공개 예정', type: 'text', icon: 'fas fa-blog' },
                    { name: '인스타그램', value: '공개 예정', type: 'text', icon: 'fab fa-instagram' },
                    { name: '스레드', value: '공개 예정', type: 'text', icon: 'fas fa-at' },
                    { name: '엑스(구 트위터)', value: '공개 예정', type: 'text', icon: 'fab fa-x-twitter' },
                    { name: '페이스북', value: '공개 예정', type: 'text', icon: 'fab fa-facebook' },
                    { name: '유튜브 채널', value: '공개 예정', type: 'text', icon: 'fab fa-youtube' },
                    { name: '디스코드(온라인 당사)', value: '공개 예정', type: 'text', icon: 'fab fa-discord' }
                ],
                committees: [
                    { name: '홍보분과', kakaoLink: null },
                    { name: '조직강화분과', kakaoLink: null },
                    { name: '정책분과', kakaoLink: null },
                    { name: '투쟁분과', kakaoLink: null },
                    { name: '자원봉사단', kakaoLink: null }
                ]
            }
        };

        // 서울 당협위원회 데이터
        const seoulChapters = [
            {
                name: "강남 갑",
                dongs: ["신사동", "논현1동", "논현2동", "압구정동", "청담동", "역삼1동", "역삼2동"],
                kakaoLink: "https://invite.kakao.com/tc/Q8wb5DlMvv",
                chairman: null
            },
            {
                name: "강남 을",
                dongs: ["개포1동", "개포2동", "개포4동", "세곡동", "일원본동", "일원1동", "일원2동", "수서동"],
                kakaoLink: "https://invite.kakao.com/tc/S4LzmhDFK8",
                chairman: null
            },
            {
                name: "강남 병",
                dongs: ["삼성1동", "삼성2동", "대치1동", "대치2동", "대치4동", "도곡1동", "도곡2동"],
                kakaoLink: "https://invite.kakao.com/tc/x6dqGoh3rh",
                chairman: null
            },
            {
                name: "강동 갑",
                dongs: ["암사1동", "암사2동", "암사3동", "명일1동", "명일2동", "고덕1동", "고덕2동", "강일동", "상일동"],
                kakaoLink: "https://invite.kakao.com/tc/FcT9mRIBrN",
                chairman: null
            },
            {
                name: "강동 을",
                dongs: ["천호1동", "천호2동", "천호3동", "성내1동", "성내2동", "성내3동", "둔촌1동", "둔촌2동", "길동"],
                kakaoLink: "https://invite.kakao.com/tc/ssYGTEfE9Z",
                chairman: null
            },
            {
                name: "강북 갑",
                dongs: ["번1동", "번2동", "우이동", "인수동", "수유1동", "수유2동", "수유3동"],
                kakaoLink: "https://invite.kakao.com/tc/uXwwzfwwxH",
                chairman: null
            },
            {
                name: "강북 을",
                dongs: ["번3동", "삼양동", "미아동", "송중동", "송천동", "삼각산동"],
                kakaoLink: "https://invite.kakao.com/tc/wv1NiWfyvm",
                chairman: null
            },
            {
                name: "강서 갑",
                dongs: ["발산1동", "우장산동", "화곡1동", "화곡2동", "화곡3동", "화곡8동"],
                kakaoLink: "https://invite.kakao.com/tc/wErhlclI9J",
                chairman: null
            },
            {
                name: "강서 을",
                dongs: ["가양1동", "가양2동", "등촌3동", "공항동", "방화1동", "방화2동", "방화3동"],
                kakaoLink: "https://invite.kakao.com/tc/VYfa9v0bOv",
                chairman: null
            },
            {
                name: "강서 병",
                dongs: ["등촌1동", "등촌2동", "가양3동", "염창동", "화곡4동", "화곡6동", "화곡본동"],
                kakaoLink: "https://invite.kakao.com/tc/Gdp6xnhlj3",
                chairman: null
            },
            {
                name: "구로 갑",
                dongs: ["개봉1동", "개봉2동", "개봉3동", "고척1동", "고척2동", "오류1동", "오류2동", "수궁동", "항동"],
                kakaoLink: "https://invite.kakao.com/tc/Grmew30A5t",
                chairman: null
            },
            {
                name: "구로 을",
                dongs: ["구로1동", "구로2동", "구로3동", "구로4동", "구로5동", "신도림동", "가리봉동"],
                kakaoLink: "https://invite.kakao.com/tc/I726mhYDub",
                chairman: null
            },
            {
                name: "금천",
                dongs: ["가산동", "독산1동", "독산2동", "독산3동", "독산4동", "시흥1동", "시흥2동", "시흥3동", "시흥4동", "시흥5동"],
                kakaoLink: "https://invite.kakao.com/tc/w16GSt7hM3",
                chairman: null
            },
            {
                name: "관악 갑",
                dongs: ["보라매동", "은천동", "성현동", "중앙동", "청림동", "행운동", "청룡동", "낙성대동", "인헌동", "남현동", "신림동"],
                kakaoLink: "https://invite.kakao.com/tc/N4ktmdyDsu",
                chairman: null
            },
            {
                name: "관악 을",
                dongs: ["신사동", "조원동", "미성동", "난곡동", "난향동", "서원동", "신원동", "서림동", "삼성동", "대학동"],
                kakaoLink: "https://invite.kakao.com/tc/fcjfBmwKhU",
                chairman: null
            },
            {
                name: "광진 갑",
                dongs: ["중곡1동", "중곡2동", "중곡3동", "중곡4동", "구의2동", "군자동", "광장동", "능동"],
                kakaoLink: "https://invite.kakao.com/tc/r8sPIxP2Ic",
                chairman: null
            },
            {
                name: "광진 을",
                dongs: ["자양1동", "자양2동", "자양3동", "자양4동", "구의1동", "구의3동", "화양동"],
                kakaoLink: "https://invite.kakao.com/tc/klUmEYr6R5",
                chairman: null
            },
            {
                name: "노원 갑",
                dongs: ["월계1동", "월계2동", "월계3동", "공릉1동", "공릉2동", "하계1동", "하계2동", "중계본동", "중계2·3동"],
                kakaoLink: "https://invite.kakao.com/tc/DkaUzITz8M",
                chairman: null
            },
            {
                name: "노원 을",
                dongs: ["중계1동", "중계4동", "상계1동", "상계2동", "상계3·4동", "상계5동", "상계6·7동", "상계8동", "상계9동", "상계10동"],
                kakaoLink: "https://invite.kakao.com/tc/WKKZQElR61",
                chairman: null
            },
            {
                name: "도봉 갑",
                dongs: ["쌍문1동", "쌍문3동", "창1동", "창2동", "창3동", "창4동", "창5동"],
                kakaoLink: "https://invite.kakao.com/tc/AHsy504VSN",
                chairman: null
            },
            {
                name: "도봉 을",
                dongs: ["쌍문2동", "쌍문4동", "방학1동", "방학2동", "방학3동", "도봉1동", "도봉2동"],
                kakaoLink: "https://invite.kakao.com/tc/YWWlpiWiyP",
                chairman: null
            },
            {
                name: "동대문 갑",
                dongs: ["휘경1동", "휘경2동", "이문1동", "이문2동", "청량리동", "용신동", "제기동", "회기동"],
                kakaoLink: "https://invite.kakao.com/tc/TN2TrcPwuz",
                chairman: null
            },
            {
                name: "동대문 을",
                dongs: ["전농1동", "전농2동", "장안1동", "장안2동", "답십리1동", "답십리2동"],
                kakaoLink: "https://invite.kakao.com/tc/TXG50mNKB5",
                chairman: null
            },
            {
                name: "동작 갑",
                dongs: ["대방동", "상도2동", "상도3동", "상도4동", "노량진1동", "노량진2동", "신대방1동", "신대방2동"],
                kakaoLink: "https://invite.kakao.com/tc/0nADJCg2rZ",
                chairman: null
            },
            {
                name: "동작 을",
                dongs: ["흑석동", "상도1동", "사당1동", "사당2동", "사당3동", "사당4동", "사당5동"],
                kakaoLink: "https://invite.kakao.com/tc/GSC2GXAsje",
                chairman: null
            },
            {
                name: "마포 갑",
                dongs: ["공덕동", "아현동", "도화동", "용강동", "대흥동", "염리동", "신수동"],
                kakaoLink: "https://invite.kakao.com/tc/PqCdf56vor",
                chairman: null
            },
            {
                name: "마포 을",
                dongs: ["서강동", "서교동", "합정동", "망원1동", "망원2동", "연남동", "성산1동", "성산2동", "상암동"],
                kakaoLink: "https://invite.kakao.com/tc/nfAJ6PPiB8",
                chairman: null
            },
            {
                name: "서초 갑",
                dongs: ["잠원동", "반포본동", "반포1동", "반포2동", "반포3동", "반포4동", "방배본동", "방배1동", "방배4동"],
                kakaoLink: "https://invite.kakao.com/tc/XdLoR2RbAz",
                chairman: null
            },
            {
                name: "서초 을",
                dongs: ["서초1동", "서초2동", "서초3동", "서초4동", "방배2동", "방배3동", "양재1동", "양재2동", "내곡동"],
                kakaoLink: "https://invite.kakao.com/tc/EUABKmafwi",
                chairman: null
            },
            {
                name: "서대문 갑",
                dongs: ["홍제1동", "홍제2동", "북아현동", "천연동", "충현동", "신촌동", "연희동"],
                kakaoLink: "https://invite.kakao.com/tc/06h4F8WWAo",
                chairman: null
            },
            {
                name: "서대문 을",
                dongs: ["홍은1동", "홍은2동", "홍제3동", "남가좌1동", "남가좌2동", "북가좌1동", "북가좌2동"],
                kakaoLink: "https://invite.kakao.com/tc/7nr9xEqDTL",
                chairman: null
            },
            {
                name: "성북 갑",
                dongs: ["길음1동", "돈암2동", "안암동", "보문동", "정릉1동", "정릉2동", "정릉3동", "정릉4동", "성북동", "삼선동", "동선동"],
                kakaoLink: "https://invite.kakao.com/tc/O9tfteKLJH",
                chairman: null
            },
            {
                name: "성북 을",
                dongs: ["돈암1동", "길음2동", "종암동", "석관동", "장위1동", "장위2동", "장위3동", "월곡1동", "월곡2동"],
                kakaoLink: "https://invite.kakao.com/tc/k2oQly2OBf",
                chairman: null
            },
            {
                name: "송파 갑",
                dongs: ["풍납1동", "풍납2동", "방이1동", "방이2동", "오륜동", "송파1동", "송파2동", "잠실4동", "잠실6동"],
                kakaoLink: "https://invite.kakao.com/tc/IJ6cVgFYnz",
                chairman: null
            },
            {
                name: "송파 을",
                dongs: ["석촌동", "삼전동", "가락1동", "문정2동", "잠실본동", "잠실2동", "잠실3동", "잠실7동"],
                kakaoLink: "https://invite.kakao.com/tc/nvfOMcNioq",
                chairman: null
            },
            {
                name: "송파 병",
                dongs: ["거여1동", "거여2동", "마천1동", "마천2동", "오금동", "가락본동", "가락2동", "문정1동", "장지동", "위례동"],
                kakaoLink: "https://invite.kakao.com/tc/eu0aGBXRPr",
                chairman: null
            },
            {
                name: "양천 갑",
                dongs: ["목1동", "목2동", "목3동", "목4동", "목5동", "신정1동", "신정2동", "신정6동", "신정7동"],
                kakaoLink: "https://invite.kakao.com/tc/C7H1vPh9Pg",
                chairman: null
            },
            {
                name: "양천 을",
                dongs: ["신월1동", "신월2동", "신월3동", "신월4동", "신월5동", "신월6동", "신월7동", "신정3동", "신정4동"],
                kakaoLink: "https://invite.kakao.com/tc/WRQQzVfmF8",
                chairman: null
            },
            {
                name: "영등포 갑",
                dongs: ["신길3동", "당산1동", "당산2동", "양평1동", "양평2동", "문래동", "영등포동", "영등포본동", "도림동"],
                kakaoLink: "https://invite.kakao.com/tc/x5ceRq3oE9",
                chairman: null
            },
            {
                name: "영등포 을",
                dongs: ["신길1동", "신길4동", "신길5동", "신길6동", "신길7동", "여의동", "대림1동", "대림2동", "대림3동"],
                kakaoLink: "https://invite.kakao.com/tc/q4hFQbBpD9",
                chairman: null
            },
            {
                name: "용산",
                dongs: ["후암동", "용산2가동", "남영동", "청파동", "원효로1동", "원효로2동", "효창동", "용문동", "한강로동", "이촌1동", "이촌2동", "이태원1동", "이태원2동", "한남동", "서빙고동", "보광동"],
                kakaoLink: "https://invite.kakao.com/tc/YcmlIpCTb6",
                chairman: null
            },
            {
                name: "은평 갑",
                dongs: ["녹번동", "역촌동", "증산동", "신사1동", "신사2동", "응암1동", "응암2동", "응암3동", "수색동"],
                kakaoLink: "https://invite.kakao.com/tc/n9yxNBceDv",
                chairman: null
            },
            {
                name: "은평 을",
                dongs: ["구산동", "대조동", "진관동", "갈현1동", "갈현2동", "불광1동", "불광2동"],
                kakaoLink: "https://invite.kakao.com/tc/7WeyD9KkWP",
                chairman: null
            },
            {
                name: "중랑 갑",
                dongs: ["상봉2동", "망우3동", "면목본동", "면목2동", "면목4동", "면목5동", "면목3·8동", "면목7동"],
                kakaoLink: "https://invite.kakao.com/tc/YMpTN9y6Yg",
                chairman: null
            },
            {
                name: "중랑 을",
                dongs: ["상봉1동", "망우본동", "중화1동", "중화2동", "신내1동", "신내2동", "묵1동", "묵2동"],
                kakaoLink: "https://invite.kakao.com/tc/WKuJmQUz54",
                chairman: null
            },
            {
                name: "중성동 갑",
                dongs: ["마장동", "사근동", "응봉동", "송정동", "용답동", "행당1동", "행당2동", "성수1가1동", "성수1가2동", "성수2가1동", "성수2가3동", "왕십리·도선동", "왕십리2동"],
                kakaoLink: "https://invite.kakao.com/tc/6yYTIR5SkZ",
                note: "성동구"
            },
            {
                name: "중성동 을",
                dongs: ["소공동", "회현동", "명동", "필동", "장충동", "광희동", "을지로동", "신당동", "다산동", "약수동", "청구동", "동화동", "황학동", "중림동", "금호1가동", "금호2·3가동", "금호4가동", "옥수동"],
                kakaoLink: "https://invite.kakao.com/tc/Wl4H4R4eAX",
                note: "중구 전 지역 + 성동구 일부"
            },
            {
                name: "종로",
                dongs: ["청운효자동", "사직동", "삼청동", "부암동", "평창동", "무악동", "교남동", "가회동", "종로1·2·3·4가동", "종로5·6가동", "이화동", "혜화동", "창신1동", "창신2동", "창신3동", "숭인1동", "숭인2동"],
                kakaoLink: "https://invite.kakao.com/tc/wC6aK7wKad",
                chairman: null
            }
        ];

        // 부산 당협위원회 데이터
        const busanChapters = [];
        
        const gyeongbukChapters = [
            {
                name: "포항시 북구",
                dongs: ["중앙동", "양학동", "죽도동", "용흥동", "우창동", "두호동", "장량동", "환여동", "흥해읍", "신광면", "청하면", "송라면", "기계면", "죽장면", "기북면"],
                kakaoLink: "https://invite.kakao.com/tc/t0lbEN6tdZ",
                chairman: null
            },
            {
                name: "포항시 남구·울릉군",
                dongs: ["상대동", "해도동", "송도동", "청림동", "제철동", "효곡동", "대이동", "구룡포읍", "연일읍", "오천읍", "대송면", "동해면", "장기면", "호미곶면"],
                kakaoLink: "https://invite.kakao.com/tc/8uA3XoVKJE",
                chairman: null
            },
            {
                name: "경주시",
                dongs: ["중부동", "황오동", "성건동", "황남동", "월성동", "선도동", "용강동", "황성동", "동천동", "불국동", "보덕동", "감포읍", "안강읍", "외동읍", "양북면", "양남면", "내남면", "산내면", "서면", "현곡면", "강동면", "천북면"],
                kakaoLink: "https://invite.kakao.com/tc/Hdz6G5cLLW",
                chairman: null
            },
            {
                name: "김천시",
                dongs: ["자산동", "평화·남산동", "양·금동", "대·신동", "대곡동", "지좌동", "율곡동", "아포읍", "농소면", "남면", "개령면", "감문면", "어모면", "봉산면", "대항면", "감천면", "조마면", "구성면", "지례면", "부항면", "대덕면", "증산면"],
                kakaoLink: "https://invite.kakao.com/tc/KqTP57ho6u",
                chairman: null
            },
            {
                name: "안동시·예천군",
                dongs: ["풍산읍", "와룡면", "북후면", "서후면", "풍천면", "일직면", "남후면", "남선면", "임하면", "길안면", "임동면", "예안면", "도산면", "녹전면", "예천읍", "호명읍", "용문면", "효자면", "은풍면", "감천면", "보문면", "유천면", "용궁면", "개포면", "지보면", "풍양면"],
                kakaoLink: "https://invite.kakao.com/tc/Anxu0BHhww",
                chairman: null
            },
            {
                name: "구미시 갑",
                dongs: ["송정동", "원평동", "지산동", "도량동", "선주원남동", "형곡1동", "형곡2동", "신평1동", "신평2동", "비산동", "공단동", "광평동", "상모사곡동", "임오동"],
                kakaoLink: "https://invite.kakao.com/tc/PTkZQW8tmg",
                chairman: null
            },
            {
                name: "구미시 을",
                dongs: ["인동동", "진미동", "양포동", "선산읍", "고아읍", "산동읍", "무을면", "옥성면", "도개면", "해평면", "장천면"],
                kakaoLink: "https://invite.kakao.com/tc/uJ2BlB2q1r",
                chairman: null
            },
            {
                name: "영주시·영양군·봉화군",
                dongs: ["상망동", "하망동", "영주1동", "영주2동", "휴천1동", "휴천2동", "휴천3동", "가흥1동", "가흥2동", "풍기읍", "이산면", "평은면", "문수면", "장수면", "안정면", "봉현면", "순흥면", "단산면", "부석면", "영양읍", "입암면", "청기면", "일월면", "수비면", "석보면", "봉화읍", "물야면", "봉성면", "법전면", "춘양면", "소천면", "석포면", "재산면", "명호면", "상운면"],
                kakaoLink: "https://invite.kakao.com/tc/vRYMKszTFh",
                chairman: null
            },
            {
                name: "영천시·청도군",
                dongs: ["동부동", "중앙동", "서부동", "완산동", "남부동", "금호읍", "청통면", "신녕면", "화산면", "화북면", "화남면", "자양면", "임고면", "고경면", "북안면", "대창면", "청도읍", "화양읍", "각남면", "풍각면", "각북면", "이서면", "운문면", "금천면", "매전면"],
                kakaoLink: "https://invite.kakao.com/tc/XTzJN14lwG",
                chairman: null
            },
            {
                name: "상주시·문경시",
                dongs: ["점촌1동", "점촌2동", "점촌3동", "점촌4동", "점촌5동", "문경읍", "가은읍", "영순면", "산양면", "호계면", "산북면", "동로면", "마성면", "농암면"],
                kakaoLink: "https://invite.kakao.com/tc/3bISKEblL2",
                chairman: null
            },
            {
                name: "경산시",
                dongs: ["중앙동", "동부동", "서부1동", "서부2동", "남부동", "북부동", "중방동", "하양읍", "진량읍", "압량읍", "와촌면", "자인면", "용성면", "남산면", "남천면"],
                kakaoLink: "https://invite.kakao.com/tc/59cgVxihIr",
                chairman: null
            },
            {
                name: "의성군·청송군·영덕군·울진군",
                dongs: ["의성읍", "단촌면", "점곡면", "옥산면", "사곡면", "춘산면", "가음면", "금성면", "봉양면", "비안면", "구천면", "단밀면", "단북면", "안계면", "다인면", "신평면", "안평면", "안사면", "청송읍", "주왕산면", "부남면", "현동면", "현서면", "안덕면", "파천면", "진보면", "영덕읍", "강구면", "남정면", "달산면", "지품면", "축산면", "영해면", "병곡면", "창수면", "울진읍", "평해읍", "북면", "금강송면", "근남면", "매화면", "기성면", "온정면", "죽변면", "후포면"],
                kakaoLink: "https://invite.kakao.com/tc/FITj2jDKrM",
                chairman: null
            },
            {
                name: "고령군·성주군·칠곡군",
                dongs: ["대가야읍", "덕곡면", "운수면", "성산면", "다산면", "개진면", "우곡면", "쌍림면", "성주읍", "선남면", "용암면", "수륜면", "가천면", "금주면", "대가면", "벽진면", "초전면", "월항면", "왜관읍", "북삼읍", "석적읍", "지천면", "동명면", "가산면", "약목면", "기산면"],
                kakaoLink: "https://invite.kakao.com/tc/qlyL91gR14",
                chairman: null
            }
        ];

        // API에서 가져온 데이터 (로드 후 채워짐)
        let apiChapters = null;

        // 현재 활성화된 당협 데이터 가져오기
        function getChapters() {
            if (currentProvince === 'seoul') {
                return apiChapters || seoulChapters;
            } else if (currentProvince === 'busan') {
                return apiChapters || busanChapters;
            } else if (currentProvince === 'gyeongbuk') {
                return apiChapters || gyeongbukChapters;
            }
            return [];
        }

        // API에서 지역구 데이터 로드
        async function loadChaptersFromAPI() {
            try {
                const apiBase = (typeof window.API_BASE !== 'undefined' ? window.API_BASE : 'https://forthefreedom-kr-production.up.railway.app/api');
                const response = await fetch(`${apiBase}/chapters?province=${currentProvince}`);
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    // API 데이터를 프론트엔드 형식으로 변환
                    apiChapters = result.data.map(chapter => ({
                        name: chapter.name,
                        dongs: chapter.dongs,
                        kakaoLink: chapter.kakaoLink,
                        note: chapter.note || null,
                        chairman: chapter.chairmanName ? {
                            name: chapter.chairmanName,
                            website: chapter.chairmanWebsite,
                            instagram: chapter.chairmanInstagram,
                            facebook: chapter.chairmanFacebook,
                            threads: chapter.chairmanThreads,
                            x: chapter.chairmanX,
                            naverBlog: chapter.chairmanNaverBlog,
                            youtube: chapter.chairmanYoutube,
                            memberId: chapter.chairmanMemberId
                        } : null
                    }));
                    console.log('✅ API에서 지역구 데이터 로드:', apiChapters.length, '개');
                }
            } catch (error) {
                console.log('⚠️ API 로드 실패, 하드코딩 데이터 사용:', error.message);
            }
        }

        // 랜딩 페이지로 이동
        function showLanding() {
            history.pushState(null, '', window.location.pathname);
            document.getElementById('landingSection').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            currentProvince = null;
            renderTabs();
            renderLandingCards();
            
            // GA4 이벤트
            if (typeof gtag !== 'undefined') {
                gtag('event', 'view_landing', {
                    'event_category': 'local_chapters'
                });
            }
        }
        
        // 랜딩 카드 렌더링
        function renderLandingCards() {
            const establishedContainer = document.getElementById('establishedCards');
            const preparingContainer = document.getElementById('preparingCards');
            
            const established = provinces.filter(p => p.status === 'established');
            const preparing = provinces.filter(p => p.status === 'preparing');
            
            establishedContainer.innerHTML = established.map(p => `
                <div onclick="switchProvince('${p.id}')" class="bg-white rounded-xl p-4 border-l-4 border-green-500 shadow cursor-pointer hover:shadow-lg transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold text-gray-900">${p.fullName}</h3>
                            <p class="text-sm text-gray-500">${p.leaderTitle}: ${p.leader}</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                </div>
            `).join('');
            
            preparingContainer.innerHTML = preparing.map(p => `
                <div onclick="switchProvince('${p.id}')" class="bg-white rounded-xl p-4 border-l-4 border-yellow-500 shadow cursor-pointer hover:shadow-lg transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold text-gray-900">${p.fullName}</h3>
                            <p class="text-sm text-gray-500">${p.leader ? p.leaderTitle + ': ' + p.leader : '준비중'}</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                </div>
            `).join('');
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', async () => {
            loadNavigation();
            renderTabs();
            
            // API에서 먼저 데이터 로드 시도 (완료 후 렌더링)
            await loadChaptersFromAPI();
            
            // 해시 URL 확인
            const hash = window.location.hash.slice(1);
            if (hash && provinces.find(p => p.id === hash)) {
                // 해시가 있고 유효한 지역이면 해당 탭으로
                switchProvince(hash);
            } else {
                // 해시가 없으면 랜딩 표시
                document.getElementById('landingSection').classList.remove('hidden');
                document.getElementById('mainContent').classList.add('hidden');
                renderLandingCards();
            }
            
            // 브라우저 뒤로가기/앞으로가기 처리
            window.addEventListener('popstate', () => {
                const hash = window.location.hash.slice(1);
                if (hash && provinces.find(p => p.id === hash)) {
                    switchProvince(hash);
                } else {
                    showLanding();
                }
            });
            
            // 엔터키 검색
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchDong();
            });
        });

        // 탭 렌더링
        function renderTabs() {
            const container = document.getElementById('tabContainer');
            
            // 전체보기 탭
            let tabsHtml = `
                <button onclick="showLanding()" 
                        id="tab-landing"
                        class="tab-btn px-4 py-2 rounded-lg text-sm font-medium transition-all ${!currentProvince ? 'bg-red-600 text-white shadow-md' : 'bg-white border-2 border-red-600 text-red-600 hover:bg-red-50'}">
                    전체보기
                </button>
            `;
            
            tabsHtml += provinces.map(province => {
                let btnClass = 'tab-btn px-4 py-2 rounded-lg text-sm font-medium transition-all ';
                
                if (province.id === currentProvince) {
                    // 현재 선택됨
                    btnClass += 'bg-red-600 text-white shadow-md';
                } else if (province.hasData) {
                    // 데이터 있음 (활성화)
                    btnClass += 'bg-white border-2 border-red-600 text-red-600 hover:bg-red-50';
                } else {
                    // 준비중
                    btnClass += 'bg-gray-100 text-gray-400 border border-gray-200';
                }
                
                return `
                    <button onclick="switchProvince('${province.id}')" 
                            id="tab-${province.id}"
                            class="${btnClass}">
                        ${province.name}
                        ${!province.hasData ? '<span class="text-xs ml-1 opacity-60">(준비중)</span>' : ''}
                    </button>
                `;
            }).join('');
            
            container.innerHTML = tabsHtml;
        }

        // 시도당 전환
        function switchProvince(provinceId) {
            currentProvince = provinceId;
            const province = provinces.find(p => p.id === provinceId);
            
            // 해시 URL 변경
            history.pushState(null, '', '#' + provinceId);
            
            // GA4 이벤트 전송
            if (typeof gtag !== 'undefined') {
                gtag('event', 'region_tab_click', {
                    'region_id': provinceId,
                    'region_name': province.name,
                    'event_category': 'local_chapters'
                });
            }
            
            // 랜딩 숨기기
            document.getElementById('landingSection').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            
            // API 데이터 초기화
            apiChapters = null;
            
            // 탭 스타일 업데이트
            renderTabs();
            
            // 검색 초기화
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResult').classList.add('hidden');
            
            if (province.hasData) {
                // 데이터가 있는 시도당
                document.getElementById('officialChannelSection').classList.remove('hidden');
                document.getElementById('chatRoomSection').classList.remove('hidden');
                document.getElementById('preparingMessage').classList.add('hidden');
                
                // 공식 채널 렌더링
                renderOfficialChannels(provinceId);
                renderCommittees(provinceId);
                
                // API에서 당협 데이터 로드
                loadChaptersFromAPI().then(() => {
                    renderChapters();
                });
            } else {
                // 준비 중인 시도당
                document.getElementById('officialChannelSection').classList.add('hidden');
                document.getElementById('chatRoomSection').classList.add('hidden');
                document.getElementById('preparingMessage').classList.remove('hidden');
                document.getElementById('preparingTitle').textContent = province.name + ' 시도당';
            }
        }

        // 공식 채널 렌더링
        function renderOfficialChannels(provinceId) {
            const channelData = officialChannels[provinceId];
            if (!channelData) return;
            
            // 모든 제목 업데이트
            document.getElementById('officialChannelTitle').textContent = channelData.title;
            document.getElementById('committeeTitle').textContent = channelData.committeeTitle;
            document.getElementById('chatRoomTitle').textContent = channelData.chatTitle;
            
            const grid = document.getElementById('officialChannelGrid');
            grid.innerHTML = channelData.channels.map(channel => {
                let cardContent = '';
                let cardClass = 'bg-white rounded-xl p-4 border border-gray-200 transition-all h-20 flex flex-col justify-center';
                let cardWrapper = '';
                
                // X 로고는 SVG로 처리
                let iconHtml = '';
                if (channel.icon === 'fab fa-x-twitter') {
                    iconHtml = `<svg class="w-5 h-5 text-red-600 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>`;
                } else {
                    iconHtml = `<i class="${channel.icon} text-red-600 text-xl flex-shrink-0"></i>`;
                }
                
                // 회색 아이콘 버전
                let grayIconHtml = '';
                if (channel.icon === 'fab fa-x-twitter') {
                    grayIconHtml = `<svg class="w-5 h-5 text-gray-400 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>`;
                } else {
                    grayIconHtml = `<i class="${channel.icon} text-gray-400 text-xl flex-shrink-0"></i>`;
                }
                
                if (channel.type === 'email') {
                    // 이메일은 값 표시 + 클릭 시 mailto
                    cardWrapper = `<a href="mailto:${channel.value}" class="block">`;
                    cardContent = `
                        <div class="flex items-center gap-3">
                            ${iconHtml}
                            <div class="min-w-0">
                                <div class="font-medium text-gray-800">${channel.name}</div>
                                <div class="text-sm text-red-600 font-medium truncate">${channel.value}</div>
                            </div>
                        </div>
                    `;
                    cardClass += ' hover:shadow-md hover:border-red-300 cursor-pointer';
                } else if (channel.type === 'kakao') {
                    // 카카오톡 오픈채팅 - 노란색 배경
                    cardWrapper = `<a href="${channel.value}" target="_blank" rel="noopener noreferrer" class="block">`;
                    cardContent = `
                        <div class="flex items-center gap-3">
                            <i class="fas fa-comment text-amber-900 text-xl flex-shrink-0"></i>
                            <span class="font-medium text-amber-900">${channel.name}</span>
                            <i class="fas fa-external-link-alt text-amber-700 text-xs ml-auto flex-shrink-0"></i>
                        </div>
                    `;
                    cardClass = 'bg-yellow-300 rounded-xl p-4 border border-yellow-400 transition-all h-20 flex flex-col justify-center hover:shadow-md hover:bg-yellow-400 cursor-pointer';
                } else if (channel.type === 'link') {
                    // 링크는 카드 클릭으로 이동
                    cardWrapper = `<a href="${channel.value}" target="_blank" rel="noopener noreferrer" class="block">`;
                    cardContent = `
                        <div class="flex items-center gap-3">
                            ${iconHtml}
                            <span class="font-medium text-gray-800">${channel.name}</span>
                            <i class="fas fa-external-link-alt text-gray-400 text-xs ml-auto flex-shrink-0"></i>
                        </div>
                    `;
                    cardClass += ' hover:shadow-md hover:border-red-300 cursor-pointer';
                } else {
                    // 텍스트(준비중 등)는 클릭 불가
                    cardWrapper = '<div class="block">';
                    cardContent = `
                        <div class="flex items-center gap-3">
                            ${grayIconHtml}
                            <div class="min-w-0">
                                <div class="font-medium text-gray-500">${channel.name}</div>
                                <div class="text-sm text-gray-400">${channel.value}</div>
                            </div>
                        </div>
                    `;
                    cardClass += ' opacity-60';
                }
                
                const closeWrapper = channel.type === 'text' ? '</div>' : '</a>';
                
                return `
                ${cardWrapper}
                    <div class="${cardClass}">
                        ${cardContent}
                    </div>
                ${closeWrapper}
                `;
            }).join('');
        }

        // 분과위원회 렌더링
        function renderCommittees(provinceId) {
            const channelData = officialChannels[provinceId];
            if (!channelData || !channelData.committees) {
                document.getElementById('committeeSection').classList.add('hidden');
                return;
            }
            
            document.getElementById('committeeSection').classList.remove('hidden');
            document.getElementById('committeeTitle').textContent = channelData.committeeTitle;
            
            const grid = document.getElementById('committeeGrid');
            grid.innerHTML = channelData.committees.map(committee => {
                if (committee.kakaoLink) {
                    return `
                        <a href="${committee.kakaoLink}" target="_blank" rel="noopener noreferrer" class="block">
                            <div class="bg-white rounded-xl p-4 border border-gray-200 transition-all h-20 flex items-center hover:shadow-md hover:border-yellow-400 cursor-pointer">
                                <div class="flex items-center gap-3 w-full">
                                    <svg class="w-6 h-6 flex-shrink-0" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M128 36C70.562 36 24 72.713 24 118c0 29.279 19.466 54.97 48.748 69.477-1.593 5.494-10.237 35.344-10.581 37.689 0 0-.207 1.762.934 2.434s2.483.15 2.483.15c3.272-.457 37.943-24.811 43.944-29.03 5.995.849 12.168 1.28 18.472 1.28 57.438 0 104-36.712 104-82 0-45.287-46.562-82-104-82z" fill="#3C1E1E"/>
                                    </svg>
                                    <span class="font-medium text-gray-800">${committee.name}</span>
                                    <i class="fas fa-external-link-alt text-gray-400 text-xs ml-auto flex-shrink-0"></i>
                                </div>
                            </div>
                        </a>
                    `;
                } else {
                    return `
                        <div class="block">
                            <div class="bg-gray-100 rounded-xl p-4 border border-gray-200 h-20 flex items-center opacity-60">
                                <div class="flex items-center gap-3 w-full">
                                    <svg class="w-6 h-6 flex-shrink-0" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M128 36C70.562 36 24 72.713 24 118c0 29.279 19.466 54.97 48.748 69.477-1.593 5.494-10.237 35.344-10.581 37.689 0 0-.207 1.762.934 2.434s2.483.15 2.483.15c3.272-.457 37.943-24.811 43.944-29.03 5.995.849 12.168 1.28 18.472 1.28 57.438 0 104-36.712 104-82 0-45.287-46.562-82-104-82z" fill="#9CA3AF"/>
                                    </svg>
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-500">${committee.name}</span>
                                        <span class="text-xs text-gray-400">공개 예정</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // 카드 렌더링
        function renderChapters(highlightTerm = null) {
            const container = document.getElementById('chaptersContainer');
            const chapters = getChapters();
            
            // 당협 데이터가 없는 경우
            if (chapters.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-users text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500 text-lg">당협위원회 구성 준비 중입니다.</p>
                        <p class="text-gray-400 text-sm mt-2">빠른 시일 내에 안내드리겠습니다.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = chapters.map((chapter, index) => {
                // 하이라이트 여부 체크 (동 + 구 모두)
                const isHighlighted = highlightTerm && isChapterMatch(chapter, highlightTerm);
                
                const dongsHtml = chapter.dongs.map(dong => {
                    const isMatched = highlightTerm && (dong.includes(highlightTerm) || highlightTerm.includes(dong.replace(/[0-9·]/g, '')));
                    return `<span class="dong-tag ${isMatched ? 'matched' : ''}">${dong}</span>`;
                }).join('');
                
                // 당협위원장 섹션
                let chairmanHtml = '';
                if (chapter.chairman) {
                    // URL에 프로토콜이 없으면 https:// 추가
                    const normalizeUrl = (url) => {
                        if (!url) return url;
                        if (url.startsWith('http://') || url.startsWith('https://')) return url;
                        return 'https://' + url;
                    };
                    
                    // SNS 아이콘 생성 (7개: 웹사이트, 인스타, 페북, 스레드, 엑스, 블로그, 유튜브)
                    let snsIcons = '';
                    if (chapter.chairman.website) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.website)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-blue-500 transition-colors" title="웹사이트">
                                       <i class="fas fa-globe"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.instagram) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.instagram)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-pink-500 transition-colors" title="인스타그램">
                                       <i class="fab fa-instagram"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.facebook) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.facebook)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-blue-600 transition-colors" title="페이스북">
                                       <i class="fab fa-facebook"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.threads) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.threads)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-gray-800 transition-colors" title="스레드">
                                       <i class="fas fa-at"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.x) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.x)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-gray-800 transition-colors" title="X(트위터)">
                                       <svg class="w-4 h-4 inline" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                     </a>`;
                    }
                    if (chapter.chairman.naverBlog) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.naverBlog)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-green-500 transition-colors" title="네이버 블로그">
                                       <i class="fas fa-blog"></i>
                                     </a>`;
                    }
                    if (chapter.chairman.youtube) {
                        snsIcons += `<a href="${normalizeUrl(chapter.chairman.youtube)}" target="_blank" rel="noopener noreferrer" 
                                       class="text-gray-500 hover:text-red-600 transition-colors" title="유튜브">
                                       <i class="fab fa-youtube"></i>
                                     </a>`;
                    }
                    
                    // 위원장 있음 - 나중에 회원 프로필 링크 연결 예정
                    chairmanHtml = `
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="text-xs text-gray-500 mb-1">당협위원장</div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-user-tie text-red-600"></i>
                                <span class="font-medium text-gray-800">${chapter.chairman.name}</span>
                                ${snsIcons ? `<div class="flex items-center gap-2 ml-2">${snsIcons}</div>` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    // 공석 - 지원하기 버튼
                    chairmanHtml = `
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="text-xs text-gray-500 mb-1">당협위원장</div>
                            <button onclick="handleApplyClick('${chapter.name}', 'seoul')" 
                               class="flex items-center gap-2 text-red-600 hover:text-red-700 transition-colors cursor-pointer bg-transparent border-none p-0">
                                <i class="fas fa-paper-plane"></i>
                                <span class="font-medium">지원하기 →</span>
                            </button>
                            <div class="text-xs text-gray-400 mt-1">(공석 - 역량있는 분들의 많은 지원 바랍니다!)</div>
                        </div>
                    `;
                }
                
                // 위원장 있는 카드는 좌측 남색 바 + 옅은 배경
                const hasChairman = chapter.chairman && chapter.chairman.name;
                const chairmanStyle = hasChairman ? 'border-l-4 border-l-[#051C4C] bg-[#051C4C]/5' : '';
                
                return `
                <div class="chapter-card bg-white border-2 ${isHighlighted ? 'border-red-600 bg-red-50' : 'border-gray-200'} ${chairmanStyle} rounded-xl p-6" 
                     data-index="${index}" id="chapter-${index}">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-900">${chapter.name}</h3>
                        ${chapter.note ? `<span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">${chapter.note}</span>` : ''}
                    </div>
                    <div class="mb-4 flex flex-wrap gap-1">
                        ${dongsHtml}
                    </div>
                    <a href="${chapter.kakaoLink}" target="_blank" rel="noopener noreferrer"
                       class="kakao-btn w-full flex items-center justify-center gap-2 py-3 rounded-lg font-bold">
                        <svg width="20" height="20" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
                            <path d="M128 36C70.562 36 24 72.713 24 118c0 29.279 19.466 54.97 48.748 69.477-1.593 5.494-10.237 35.344-10.581 37.689 0 0-.207 1.762.934 2.434s2.483.15 2.483.15c3.272-.457 37.943-24.811 43.944-29.03 5.995.849 12.168 1.28 18.472 1.28 57.438 0 104-36.712 104-82 0-45.287-46.562-82-104-82z" fill="#000000"/>
                        </svg>
                        카카오톡 팀채팅 참여
                    </a>
                    ${chairmanHtml}
                </div>
                `;
            }).join('');
        }

        // 검색 매칭 함수 (동 + 구 이름 모두 검색)
        function isChapterMatch(chapter, searchTerm) {
            // 구 이름으로 검색 (예: "강남", "강남구", "송파" 등)
            const normalizedSearch = searchTerm.replace(/구$/, ''); // "강남구" -> "강남"
            const chapterGu = chapter.name.split(' ')[0]; // "강남 갑" -> "강남"
            
            if (chapterGu.includes(normalizedSearch) || normalizedSearch.includes(chapterGu)) {
                return true;
            }
            
            // 동 이름으로 검색
            return chapter.dongs.some(dong => 
                dong.includes(searchTerm) || searchTerm.includes(dong.replace(/[0-9·]/g, ''))
            );
        }

        // 검색 함수
        function searchDong() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const resultEl = document.getElementById('searchResult');
            const chapters = getChapters();
            
            if (!searchTerm) {
                resultEl.classList.add('hidden');
                renderChapters();
                return;
            }
            
            // 검색어로 해당 지역구 찾기 (동 + 구 모두)
            const matchedChapters = chapters.filter(chapter => isChapterMatch(chapter, searchTerm));
            
            if (matchedChapters.length > 0) {
                resultEl.innerHTML = `<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i>"${searchTerm}" → <strong>${matchedChapters.map(c => c.name).join(', ')}</strong> 지역구입니다.</span>`;
                resultEl.classList.remove('hidden');
                
                // 카드 하이라이트 및 스크롤
                renderChapters(searchTerm);
                
                // 첫 번째 매칭 카드로 스크롤
                const firstMatchIndex = chapters.findIndex(chapter => isChapterMatch(chapter, searchTerm));
                if (firstMatchIndex >= 0) {
                    setTimeout(() => {
                        document.getElementById(`chapter-${firstMatchIndex}`).scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }, 100);
                }
            } else {
                resultEl.innerHTML = `<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i>"${searchTerm}"에 해당하는 지역구를 찾을 수 없습니다. 행정동 또는 구 이름을 입력해주세요.</span>`;
                resultEl.classList.remove('hidden');
                renderChapters();
            }
        }

        // ========== 지원하기 기능 ==========
        const API_BASE = window.API_BASE || 'https://forthefreedom-kr-production.up.railway.app/api';
        let currentApplyDistrict = '';
        let currentApplyProvince = '';

        // 지원하기 버튼 클릭 핸들러
        function handleApplyClick(districtName, province) {
            currentApplyDistrict = districtName;
            currentApplyProvince = province;

            const token = localStorage.getItem('memberToken');
            const memberInfo = JSON.parse(localStorage.getItem('memberInfo') || 'null');

            if (!token || !memberInfo) {
                // 비로그인 → 로그인 모달
                showLoginModal();
            } else if (memberInfo.memberType === 'general') {
                // 일반회원 → 당원 가입 안내
                showPartyJoinModal();
            } else {
                // 당원/혁신당원 → 지원 폼 모달
                showApplicationModal(memberInfo);
            }
        }

        // 로그인 모달 표시
        function showLoginModal() {
            document.getElementById('loginRequiredModal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginRequiredModal').classList.add('hidden');
        }

        function goToLogin() {
            // 현재 페이지 URL을 파라미터로 전달
            const returnUrl = encodeURIComponent(window.location.href);
            window.location.href = `/login.html?return=${returnUrl}`;
        }

        // 당원 가입 안내 모달
        function showPartyJoinModal() {
            document.getElementById('partyJoinModal').classList.remove('hidden');
        }

        function closePartyJoinModal() {
            document.getElementById('partyJoinModal').classList.add('hidden');
        }

        // 지원 폼 모달
        function showApplicationModal(user) {
            document.getElementById('applyDistrictName').textContent = currentApplyDistrict;
            document.getElementById('applyDistrictInput').value = currentApplyDistrict;
            document.getElementById('applyProvinceInput').value = currentApplyProvince;
            document.getElementById('applicantName').value = user.name || '';
            document.getElementById('applicantEmail').value = user.email || '';
            document.getElementById('applicantPhone').value = user.phone || '';
            document.getElementById('applicantMemberId').value = user.id || '';
            document.getElementById('applicationModal').classList.remove('hidden');
        }

        function closeApplicationModal() {
            document.getElementById('applicationModal').classList.add('hidden');
            document.getElementById('applicationForm').reset();
        }

        // 지원서 제출
        async function submitApplication(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitApplicationBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>제출 중...';

            try {
                const formData = new FormData();
                formData.append('districtName', document.getElementById('applyDistrictInput').value);
                formData.append('province', document.getElementById('applyProvinceInput').value);
                formData.append('applicantName', document.getElementById('applicantName').value);
                formData.append('applicantEmail', document.getElementById('applicantEmail').value);
                formData.append('applicantPhone', document.getElementById('applicantPhone').value);
                formData.append('memberId', document.getElementById('applicantMemberId').value);
                formData.append('motivation', document.getElementById('applicantMotivation').value);

                const resumeFile = document.getElementById('resumeFile').files[0];
                const coverLetterFile = document.getElementById('coverLetterFile').files[0];

                if (resumeFile) formData.append('resume', resumeFile);
                if (coverLetterFile) formData.append('coverLetter', coverLetterFile);

                if (!resumeFile && !coverLetterFile) {
                    alert('이력서 또는 자기소개서를 최소 1개 이상 첨부해주세요.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    return;
                }

                const response = await fetch(`${API_BASE}/applications/chapter-chairman`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    closeApplicationModal();
                    showSuccessModal();
                } else {
                    alert(result.message || '지원서 제출에 실패했습니다.');
                }
            } catch (error) {
                console.error('지원서 제출 오류:', error);
                alert('지원서 제출 중 오류가 발생했습니다.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        // 성공 모달
        function showSuccessModal() {
            document.getElementById('successModal').classList.remove('hidden');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        // 파일 선택 시 파일명 표시
        function updateFileName(inputId, displayId) {
            const input = document.getElementById(inputId);
            const display = document.getElementById(displayId);
            if (input.files.length > 0) {
                display.textContent = input.files[0].name;
                display.classList.remove('text-gray-400');
                display.classList.add('text-gray-700');
            } else {
                display.textContent = '파일을 선택하세요 (PDF, DOC, HWP)';
                display.classList.add('text-gray-400');
                display.classList.remove('text-gray-700');
            }
        }
    </script>

    <!-- 로그인 필요 모달 -->
    <div id="loginRequiredModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-lock text-red-600 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">로그인이 필요합니다</h3>
                <p class="text-gray-600 mb-6">당협위원장 지원을 위해서는<br>먼저 로그인해주세요.</p>
                <div class="flex gap-3">
                    <button onclick="closeLoginModal()" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        취소
                    </button>
                    <button onclick="goToLogin()" class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        로그인하기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 당원 가입 안내 모달 -->
    <div id="partyJoinModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center">
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-id-card text-yellow-600 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">당원만 지원 가능합니다</h3>
                <p class="text-gray-600 mb-6">당협위원장 지원은 당원만 가능합니다.<br>먼저 당원으로 가입해주세요.</p>
                <div class="flex gap-3">
                    <button onclick="closePartyJoinModal()" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        취소
                    </button>
                    <a href="https://www.ihappynanum.com/Nanum/api/screen/F7FCRIO2E3" target="_blank" 
                       class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-center">
                        당원 가입하기
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- 지원 폼 모달 -->
    <div id="applicationModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 my-8 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900">
                    <i class="fas fa-file-alt text-red-600 mr-2"></i>당협위원장 지원
                </h3>
                <button onclick="closeApplicationModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                <div class="text-sm text-gray-600">지원 지역구</div>
                <div class="text-lg font-bold text-red-600" id="applyDistrictName"></div>
            </div>

            <form id="applicationForm" onsubmit="submitApplication(event)">
                <input type="hidden" id="applyDistrictInput">
                <input type="hidden" id="applyProvinceInput">
                <input type="hidden" id="applicantMemberId">

                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">성명</label>
                            <input type="text" id="applicantName" required readonly
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">연락처</label>
                            <input type="text" id="applicantPhone" required readonly
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">이메일</label>
                        <input type="email" id="applicantEmail" required readonly
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">지원 동기 <span class="text-red-500">*</span></label>
                        <textarea id="applicantMotivation" rows="4" required placeholder="간단한 지원 동기를 작성해주세요."
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">이력서 (자율양식) <span class="text-red-500">*</span></label>
                        <label class="flex items-center gap-3 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-red-400 transition-colors">
                            <i class="fas fa-upload text-gray-400"></i>
                            <span id="resumeFileName" class="text-gray-400 text-sm">파일을 선택하세요 (PDF, DOC, HWP)</span>
                            <input type="file" id="resumeFile" accept=".pdf,.doc,.docx,.hwp" class="hidden" onchange="updateFileName('resumeFile', 'resumeFileName')">
                        </label>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">자기소개서 (자율양식) <span class="text-red-500">*</span></label>
                        <label class="flex items-center gap-3 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-red-400 transition-colors">
                            <i class="fas fa-upload text-gray-400"></i>
                            <span id="coverLetterFileName" class="text-gray-400 text-sm">파일을 선택하세요 (PDF, DOC, HWP)</span>
                            <input type="file" id="coverLetterFile" accept=".pdf,.doc,.docx,.hwp" class="hidden" onchange="updateFileName('coverLetterFile', 'coverLetterFileName')">
                        </label>
                    </div>

                    <p class="text-xs text-gray-500">* 이력서와 자기소개서 중 최소 1개 이상 첨부해주세요. (각 10MB 이하)</p>
                </div>

                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeApplicationModal()" 
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        취소
                    </button>
                    <button type="submit" id="submitApplicationBtn"
                            class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>지원서 제출
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 성공 모달 -->
    <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-green-600 text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">지원서가 접수되었습니다</h3>
                <p class="text-gray-600 mb-6">서류 검토 후 담당자가<br>연락 드리도록 하겠습니다.</p>
                <button onclick="closeSuccessModal()" class="w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                    확인
                </button>
            </div>
        </div>
    </div>
    <!-- 공통 푸터 -->
    <div id="footer-container"></div>
    <script src="/footer.js"></script>
</body>
</html>
