<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E0H9DY9T0F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E0H9DY9T0F');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주요일정 - 자유와혁신</title>
    
    <!-- SEO 메타 태그 -->
    <meta name="description" content="자유와혁신의 주요 일정과 행사 정보를 확인하세요. 당원 모임, 정치 활동, 공개 행사 일정을 제공합니다.">
    <meta name="keywords" content="자유와혁신, 주요일정, 행사일정, 당원모임, 정치활동, 황교안, 일정표">
    <meta name="author" content="자유와혁신">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://forthefreedom.kr/news/events.html">
    
    <!-- 파비콘 설정 -->
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon.png">
    <link rel="shortcut icon" type="image/png" href="../images/favicon.png">
    <link rel="icon" href="../images/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'party-red': '#A50034',
                        'party-red-dark': '#8B002C',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    
    <style>
        body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
        
        /* 일정 카드 스타일 */
        .event-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
            cursor: pointer;
        }
        .event-card:hover {
            border-color: #A50034;
            box-shadow: 0 4px 12px rgba(165, 0, 52, 0.1);
        }
        
        /* 날짜 박스 */
        .date-box {
            min-width: 60px;
            text-align: center;
            padding: 8px 12px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 3px solid #A50034;
        }
        .date-box .day {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            line-height: 1.2;
        }
        .date-box .weekday {
            font-size: 12px;
            color: #6b7280;
        }
        
        /* 로딩/에러 상태 */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #A50034;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 연도/월 구분선 */
        .month-divider {
            display: flex;
            align-items: center;
            margin: 32px 0 16px 0;
        }
        .month-divider::before,
        .month-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e5e7eb;
        }
        .month-divider span {
            padding: 0 16px;
            font-weight: 600;
            color: #A50034;
            font-size: 14px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="navigation-container"></div>
    <script src="../nav.js"></script>
    <script src="../side-widget.js"></script>

    <!-- 페이지 헤더 -->
    <section class="bg-gray-50 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="flex items-center space-x-2 text-sm text-gray-500 mb-4">
                <a href="../index.html" class="hover:text-party-red">홈</a>
                <span>/</span>
                <a href="index.html" class="hover:text-party-red">소식</a>
                <span>/</span>
                <span class="text-gray-900">주요 일정</span>
            </nav>
            <h1 class="text-3xl font-bold text-gray-900">주요 일정</h1>
            <p class="mt-2 text-gray-600">자유와혁신의 모든 일정을 확인하세요</p>
        </div>
    </section>

    <!-- 메인 컨텐츠 -->
    <main class="bg-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- 탭 네비게이션 -->
            <div class="flex items-center gap-4 mb-8 border-b border-gray-200">
                <button id="tab-upcoming" onclick="EventsPage.showTab('upcoming')" class="px-4 py-3 font-medium border-b-2 border-party-red text-party-red">
                    다가오는 일정
                </button>
                <button id="tab-past" onclick="EventsPage.showTab('past')" class="px-4 py-3 font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                    지난 일정
                </button>
            </div>
            
            <!-- 일정 리스트 컨테이너 -->
            <div id="events-container">
                <div class="flex justify-center py-16">
                    <div class="loading-spinner"></div>
                </div>
            </div>
            
            <!-- 더보기 버튼 -->
            <div id="load-more-container" class="text-center mt-8 hidden">
                <button onclick="EventsPage.loadMore()" class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-colors">
                    더 보기 <i class="fas fa-chevron-down ml-2"></i>
                </button>
            </div>
        </div>
    </main>

    <div id="footer-container"></div>
    <script src="../footer.js"></script>

    <script>
    const EventsPage = {
        config: {
            apiKey: 'AIzaSyA0sZB6XDRiv1oGiZsy5Sj6EfwAoTCwyLY',
            calendarId: 'c_247b26bfef68b603b79b35081977bd0c9a2980fb904a37569f28a7ba07e82c96@group.calendar.google.com',
            maxResults: 250
        },

        allEvents: [],
        displayedCount: 0,
        pageSize: 20,
        currentTab: 'upcoming',
        isEnPage: window.location.pathname.startsWith('/en/') || window.location.pathname === '/en',

        init: function() {
            this.fetchAllEvents();
        },

        // 모든 일정 가져오기 (과거 1년 ~ 미래 1년)
        fetchAllEvents: async function() {
            const now = new Date();
            const oneYearAgo = new Date(now);
            oneYearAgo.setFullYear(now.getFullYear() - 1);
            const oneYearLater = new Date(now);
            oneYearLater.setFullYear(now.getFullYear() + 1);

            const timeMin = oneYearAgo.toISOString();
            const timeMax = oneYearLater.toISOString();

            const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(this.config.calendarId)}/events?key=${this.config.apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&maxResults=${this.config.maxResults}&singleEvents=true&orderBy=startTime`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    console.error('Google Calendar API 오류:', data.error);
                    this.showError();
                    return;
                }

                this.allEvents = (data.items || []).map(event => {
                    let eventDate, eventTime, eventDateTime;
                    
                    if (event.start.date) {
                        // 종일 일정
                        eventDate = event.start.date;
                        eventTime = this.isEnPage ? 'All day' : '종일';
                        eventDateTime = new Date(event.start.date + 'T00:00:00');
                    } else if (event.start.dateTime) {
                        // 시간 지정 일정
                        const startDt = new Date(event.start.dateTime);
                        eventDate = startDt.toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });
                        const startTime = startDt.toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit', hour12: false });
                        eventDateTime = startDt;
                        
                        // 종료 시간 추가
                        if (event.end && event.end.dateTime) {
                            const endDt = new Date(event.end.dateTime);
                            const endTime = endDt.toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit', hour12: false });
                            eventTime = `${startTime} ~ ${endTime}`;
                        } else {
                            eventTime = startTime;
                        }
                    }
                    
                    return {
                        id: event.id,
                        title: event.summary || (this.isEnPage ? '(No title)' : '(제목 없음)'),
                        date: eventDate,
                        time: eventTime,
                        dateTime: eventDateTime,
                        location: event.location || '',
                        description: event.description || '',
                        url: event.htmlLink || '#',
                        color: this.getEventColor(event)
                    };
                });

                this.renderEvents();

            } catch (error) {
                console.error('캘린더 로딩 오류:', error);
                this.showError();
            }
        },

        getEventColor: function(event) {
            const colors = {
                '1': '#7986cb', '2': '#33b679', '3': '#8e24aa', '4': '#e67c73',
                '5': '#f6bf26', '6': '#f4511e', '7': '#039be5', '8': '#616161',
                '9': '#3f51b5', '10': '#0b8043', '11': '#d50000'
            };
            return colors[event.colorId] || '#a50034';
        },

        showTab: function(tab) {
            this.currentTab = tab;
            this.displayedCount = 0;
            
            // 탭 스타일 변경
            document.getElementById('tab-upcoming').className = tab === 'upcoming' 
                ? 'px-4 py-3 font-medium border-b-2 border-party-red text-party-red'
                : 'px-4 py-3 font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700';
            document.getElementById('tab-past').className = tab === 'past'
                ? 'px-4 py-3 font-medium border-b-2 border-party-red text-party-red'
                : 'px-4 py-3 font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700';
            
            this.renderEvents();
        },

        getFilteredEvents: function() {
            const now = new Date();
            now.setHours(0, 0, 0, 0);
            
            if (this.currentTab === 'upcoming') {
                // 오늘 이후 일정 (오름차순)
                return this.allEvents
                    .filter(e => e.dateTime >= now)
                    .sort((a, b) => a.dateTime - b.dateTime);
            } else {
                // 오늘 이전 일정 (내림차순 - 최신순)
                return this.allEvents
                    .filter(e => e.dateTime < now)
                    .sort((a, b) => b.dateTime - a.dateTime);
            }
        },

        renderEvents: function() {
            const container = document.getElementById('events-container');
            const loadMoreBtn = document.getElementById('load-more-container');
            const filteredEvents = this.getFilteredEvents();
            
            if (filteredEvents.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-16">
                        <i class="fas fa-calendar-times text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">${this.currentTab === 'upcoming' ? '예정된 일정이 없습니다.' : '지난 일정이 없습니다.'}</p>
                    </div>
                `;
                loadMoreBtn.classList.add('hidden');
                return;
            }
            
            // 표시할 일정
            const eventsToShow = filteredEvents.slice(0, this.displayedCount + this.pageSize);
            this.displayedCount = eventsToShow.length;
            
            let html = '';
            let currentYearMonth = '';
            
            eventsToShow.forEach(event => {
                const eventDate = new Date(event.date);
                const yearMonth = `${eventDate.getFullYear()}년 ${eventDate.getMonth() + 1}월`;
                
                // 월 구분선
                if (yearMonth !== currentYearMonth) {
                    currentYearMonth = yearMonth;
                    html += `<div class="month-divider"><span>${yearMonth}</span></div>`;
                }
                
                // 요일 계산
                const weekdays = this.isEnPage 
                    ? ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                    : ['일', '월', '화', '수', '목', '금', '토'];
                const weekday = weekdays[eventDate.getDay()];
                const day = eventDate.getDate();
                
                html += `
                    <div class="event-card flex items-start gap-4" onclick="window.open('${event.url}', '_blank')">
                        <div class="date-box" style="border-left-color: ${event.color};">
                            <div class="day">${day}</div>
                            <div class="weekday">${weekday}</div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-semibold text-gray-900 text-lg mb-1">${event.title}</h3>
                            <div class="flex flex-wrap items-center gap-3 text-sm text-gray-500">
                                <span><i class="far fa-clock mr-1"></i>${event.time}</span>
                                ${event.location ? `<span><i class="fas fa-map-marker-alt mr-1"></i>${event.location}</span>` : ''}
                            </div>
                            ${event.description && !event.description.startsWith('http') ? `<p class="text-gray-600 text-sm mt-2 line-clamp-2">${event.description}</p>` : ''}
                        </div>
                        <div class="text-gray-400">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // 더보기 버튼 표시 여부
            if (this.displayedCount < filteredEvents.length) {
                loadMoreBtn.classList.remove('hidden');
            } else {
                loadMoreBtn.classList.add('hidden');
            }
        },

        loadMore: function() {
            this.renderEvents();
        },

        showError: function() {
            document.getElementById('events-container').innerHTML = `
                <div class="text-center py-16">
                    <i class="fas fa-exclamation-circle text-4xl text-red-300 mb-4"></i>
                    <p class="text-gray-500">일정을 불러오는 중 오류가 발생했습니다.</p>
                    <button onclick="EventsPage.fetchAllEvents()" class="mt-4 px-4 py-2 bg-party-red text-white rounded-lg hover:bg-party-red-dark">
                        다시 시도
                    </button>
                </div>
            `;
        }
    };

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', () => EventsPage.init());
    </script>
</body>
</html>
